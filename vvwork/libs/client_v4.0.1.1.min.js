/*! (C) 2018 VirWork-Web-Client */
var VvWork=VvWork||{};VvWork.ArrayBufferReader=function(b){var a=this;b.onblob=function(f){var g=window.atob(f);var d=new ArrayBuffer(g.length);var e=new Uint8Array(d);for(var c=0;c<g.length;c++){e[c]=g.charCodeAt(c)}if(a.ondata){a.ondata(d)}};b.onend=function(){if(a.onend){a.onend()}};this.ondata=null;this.onend=null};var VvWork=VvWork||{};VvWork.ArrayBufferWriter=function(c){var b=this;c.onack=function(d){if(b.onack){b.onack(d)}};function a(d){var f="";for(var e=0;e<d.byteLength;e++){f+=String.fromCharCode(d[e])}c.sendBlob(window.btoa(f))}this.blobLength=VvWork.ArrayBufferWriter.DEFAULT_BLOB_LENGTH;this.sendData=function(e){var d=new Uint8Array(e);if(d.length<=b.blobLength){a(d)}else{for(var f=0;f<d.length;f+=b.blobLength){a(d.subarray(f,f+b.blobLength))}}};this.sendEnd=function(){c.sendEnd()};this.onack=null};VvWork.ArrayBufferWriter.DEFAULT_BLOB_LENGTH=6048;var VvWork=VvWork||{};VvWork.AudioContextFactory={singleton:null,getAudioContext:function getAudioContext(){var b=window.AudioContext||window.webkitAudioContext;if(b){try{if(!VvWork.AudioContextFactory.singleton){VvWork.AudioContextFactory.singleton=new b()}return VvWork.AudioContextFactory.singleton}catch(a){}}return null}};var VvWork=VvWork||{};VvWork.AudioPlayer=function AudioPlayer(){this.sync=function a(){}};VvWork.AudioPlayer.isSupportedType=function isSupportedType(a){return VvWork.RawAudioPlayer.isSupportedType(a)};VvWork.AudioPlayer.getSupportedTypes=function getSupportedTypes(){return VvWork.RawAudioPlayer.getSupportedTypes()};VvWork.AudioPlayer.getInstance=function getInstance(b,a){if(VvWork.RawAudioPlayer.isSupportedType(a)){return new VvWork.RawAudioPlayer(b,a)}return null};VvWork.RawAudioPlayer=function RawAudioPlayer(e,a){var n=VvWork.RawAudioPlayer._Format.parse(a);var d=VvWork.AudioContextFactory.getAudioContext();var m=d.currentTime;var b=new VvWork.ArrayBufferReader(e);var o=0.02;var j=0.3;var k=(n.bytesPerSample===1)?window.Int8Array:window.Int16Array;var i=(n.bytesPerSample===1)?128:32768;var g=[];var f=function f(v){if(v.length<=1){return v[0]}var x=0;v.forEach(function s(y){x+=y.length});var w=0;var t=new k(x);v.forEach(function u(y){t.set(y,w);w+=y.length});return t};var q=function q(v){var z=Number.MAX_VALUE;var x=v.length;var y=Math.floor(v.length/n.channels);var A=Math.floor(n.rate*o);var s=Math.max(n.channels*A,n.channels*(y-A));for(var u=s;u<v.length;u+=n.channels){var t=0;for(var w=0;w<n.channels;w++){t+=Math.abs(v[u+w])}if(t<=z){x=u+n.channels;z=t}}if(x===v.length){return[v]}return[new k(v.buffer.slice(0,x*n.bytesPerSample)),new k(v.buffer.slice(x*n.bytesPerSample))]};var c=function c(s){g.push(new k(s))};var r=function r(){var s=f(g);if(!s){return null}g=q(s);s=g.shift();return s};var p=function p(y){var u=y.length/n.channels;var s=d.currentTime;if(m<s){m=s}var x=d.createBuffer(n.channels,u,n.rate);for(var w=0;w<n.channels;w++){var t=x.getChannelData(w);var z=w;for(var v=0;v<u;v++){t[v]=y[z]/i;z+=n.channels}}return x};b.ondata=function l(u){c(new k(u));var v=r();if(!v){return}var s=d.currentTime;if(m<s){m=s}var t=d.createBufferSource();t.connect(d.destination);if(!t.start){t.start=t.noteOn}t.buffer=p(v);t.start(m);m+=v.length/n.channels/n.rate};this.sync=function h(){var s=d.currentTime;m=Math.min(m,s+j)}};VvWork.RawAudioPlayer.prototype=new VvWork.AudioPlayer();VvWork.RawAudioPlayer._Format=function _Format(a){this.bytesPerSample=a.bytesPerSample;this.channels=a.channels;this.rate=a.rate};VvWork.RawAudioPlayer._Format.parse=function parseFormat(g){var b;var f=null;var e=1;if(g.substring(0,9)==="audio/L8;"){g=g.substring(9);b=1}else{if(g.substring(0,10)==="audio/L16;"){g=g.substring(10);b=2}else{return null}}var k=g.split(",");for(var d=0;d<k.length;d++){var j=k[d];var c=j.indexOf("=");if(c===-1){return null}var a=j.substring(0,c);var h=j.substring(c+1);switch(a){case"channels":e=parseInt(h);break;case"rate":f=parseInt(h);break;default:return null}}if(f===null){return null}return new VvWork.RawAudioPlayer._Format({bytesPerSample:b,channels:e,rate:f})};VvWork.RawAudioPlayer.isSupportedType=function isSupportedType(a){if(!VvWork.AudioContextFactory.getAudioContext()){return false}return VvWork.RawAudioFormat.parse(a)!==null};VvWork.RawAudioPlayer.getSupportedTypes=function getSupportedTypes(){if(!VvWork.AudioContextFactory.getAudioContext()){return[]}return["audio/L8","audio/L16"]};var VvWork=VvWork||{};VvWork.AudioRecorder=function AudioRecorder(){this.onclose=null;this.onerror=null};VvWork.AudioRecorder.isSupportedType=function isSupportedType(a){return VvWork.RawAudioRecorder.isSupportedType(a)};VvWork.AudioRecorder.getSupportedTypes=function getSupportedTypes(){return VvWork.RawAudioRecorder.getSupportedTypes()};VvWork.AudioRecorder.getInstance=function getInstance(b,a){if(VvWork.RawAudioRecorder.isSupportedType(a)){return new VvWork.RawAudioRecorder(b,a)}return null};VvWork.RawAudioRecorder=function RawAudioRecorder(f,a){var e=this;var x=2048;var j=3;var u=VvWork.RawAudioFormat.parse(a);var c=VvWork.AudioContextFactory.getAudioContext();if(!navigator.mediaDevices){navigator.mediaDevices={}}if(!navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator)}var l=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator);var t=new VvWork.ArrayBufferWriter(f);var r=(u.bytesPerSample===1)?window.Int8Array:window.Int16Array;var m=(u.bytesPerSample===1)?128:32768;var w=0;var v=0;var s=null;var q=null;var d=null;var p=function p(y){if(y===0){return 1}var z=Math.PI*y;return Math.sin(z)/z};var i=function i(y,z){if(-z<y&&y<z){return p(y)*p(y/z)}return 0};var o=function n(A,C){var z=(A.length-1)*C;var E=Math.floor(z)-j+1;var y=Math.floor(z)+j;var D=0;for(var B=E;B<=y;B++){D+=(A[B]||0)*i(z-B,j)}return D};var g=function g(E){var y=E.length;w+=y;var F=Math.round(w*u.rate/E.sampleRate);var G=F-v;v+=G;var B=new r(G*u.channels);for(var C=0;C<u.channels;C++){var D=E.getChannelData(C);var z=C;for(var A=0;A<G;A++){B[z]=o(D,A/(G-1))*m;z+=u.channels}}return B};var h=function h(){navigator.mediaDevices.getUserMedia({audio:true},function z(B){d=c.createScriptProcessor(x,u.channels,u.channels);d.connect(c.destination);d.onaudioprocess=function A(C){t.sendData(g(C.inputBuffer).buffer)};q=c.createMediaStreamSource(B);q.connect(d);s=B},function y(){t.sendEnd();if(e.onerror){e.onerror()}})};var k=function k(){if(q){q.disconnect()}if(d){d.disconnect()}if(s){var y=s.getTracks();for(var z=0;z<y.length;z++){y[z].stop()}}d=null;q=null;s=null;t.sendEnd()};t.onack=function b(y){if(y.code===VvWork.Status.Code.SUCCESS&&!s){h()}else{k();t.onack=null;if(y.code===VvWork.Status.Code.RESOURCE_CLOSED){if(e.onclose){e.onclose()}}else{if(e.onerror){e.onerror()}}}}};VvWork.RawAudioRecorder.prototype=new VvWork.AudioRecorder();VvWork.RawAudioRecorder.isSupportedType=function isSupportedType(a){if(!VvWork.AudioContextFactory.getAudioContext()){return false}return VvWork.RawAudioFormat.parse(a)!==null};VvWork.RawAudioRecorder.getSupportedTypes=function getSupportedTypes(){if(!VvWork.AudioContextFactory.getAudioContext()){return[]}return["audio/L8","audio/L16"]};var VvWork=VvWork||{};VvWork.BlobReader=function(e,a){var d=this;var c=0;var b;if(window.BlobBuilder){b=new BlobBuilder()}else{if(window.WebKitBlobBuilder){b=new WebKitBlobBuilder()}else{if(window.MozBlobBuilder){b=new MozBlobBuilder()}else{b=new (function(){var f=[];this.append=function(g){f.push(new Blob([g],{type:a}))};this.getBlob=function(){return new Blob(f,{type:a})}})()}}}e.onblob=function(j){var k=window.atob(j);var g=new ArrayBuffer(k.length);var h=new Uint8Array(g);for(var f=0;f<k.length;f++){h[f]=k.charCodeAt(f)}b.append(g);c+=g.byteLength;if(d.onprogress){d.onprogress(g.byteLength)}e.sendAck("OK",0)};e.onend=function(){if(d.onend){d.onend()}};this.getLength=function(){return c};this.getBlob=function(){return b.getBlob()};this.onprogress=null;this.onend=null};var VvWork=VvWork||{};VvWork.BlobWriter=function BlobWriter(d){var f=this;var a=new VvWork.ArrayBufferWriter(d);a.onack=function(g){if(f.onack){f.onack(g)}};var c=function c(h,l,g){var i=(h.slice||h.webkitSlice||h.mozSlice).bind(h);var j=g-l;if(j!==g){var k=i(l,j);if(k.size===j){return k}}return i(l,g)};this.sendBlob=function b(i){var l=0;var g=new FileReader();var k=function k(){if(l>=i.size){if(f.oncomplete){f.oncomplete(i)}return}var m=c(i,l,l+a.blobLength);l+=a.blobLength;g.readAsArrayBuffer(m)};g.onload=function h(){a.sendData(g.result);a.onack=function m(n){if(f.onack){f.onack(n)}if(n.isError()){return}if(f.onprogress){f.onprogress(i,l-a.blobLength)}k()}};g.onerror=function j(){if(f.onerror){f.onerror(i,l,g.error)}};k()};this.sendEnd=function e(){a.sendEnd()};this.onack=null;this.onerror=null;this.onprogress=null;this.oncomplete=null};var VvWork=VvWork||{};VvWork.Client=function(h,j){var J=new VvWork.Logger();var n=this;var w=0;var c=1;var A=2;var y=3;var p=4;var L=5;var t=w;var F=0;var u=null;var k={0:"butt",1:"round",2:"square"};var M={0:"bevel",1:"miter",2:"round"};var v=!!!!j?j.client.getDisplay():new VvWork.Display(j);if(!!!!j){J.i("client instance display view:"+j.lastScale)}var C={};var x={};var G={};var l=[];var s=[];var D=[];var H=new VvWork.IntegerPool();var N=[];function I(P){if(P!=t){t=P;if(n.onstatechange){n.onstatechange(t)}}}function z(){var P=(t==y||t==A);J.e("isConnected(currentState="+t+"):"+P);return P}this.exportState=function q(T){var R={currentState:t,currentTimestamp:F,layers:{}};var P={};for(var Q in C){P[Q]=C[Q]}v.flush(function S(){for(var X in P){var V=parseInt(X);var W=P[X];var U=W.toCanvas();var Y={width:W.width,height:W.height};if(W.width&&W.height){Y.url=U.toDataURL("image/png")}if(V>0){Y.x=W.x;Y.y=W.y;Y.z=W.z;Y.alpha=W.alpha;Y.matrix=W.matrix;Y.parent=o(W.parent)}R.layers[X]=Y}T(R)})};this.importState=function E(U,W){var S;var Q;t=U.currentState;F=U.currentTimestamp;for(S in C){Q=parseInt(S);if(Q>0){v.dispose(C[S])}}C={};for(S in U.layers){Q=parseInt(S);var V=U.layers[S];var R=b(Q);v.resize(R,V.width,V.height);if(V.url){v.setChannelMask(R,VvWork.Layer.SRC);v.draw(R,0,0,V.url)}if(Q>0&&V.parent>=0){var T=b(V.parent);v.move(R,T,V.x,V.y,V.z);v.shade(R,V.alpha);var P=V.matrix;v.distort(R,P[0],P[1],P[2],P[3],P[4],P[5])}}v.flush(W)};this.getDisplay=function(){return v};this.sendSize=function(Q,P){if(!z()){return}h.sendMessage("size",Q,P)};this.sendVirworkText=function(T){if(!z()){return}if(!!!T){return}var Q="input:";var R=T.length;var P=999;if(R>P){var S=Q+P+T.substring(0,P);h.sendMessage("virwork",T);this.sendVirworkText(T.substring(P,R))}else{if(R<10){R="00"+R}else{if(R<100){R="0"+R}}T=Q+R+T;h.sendMessage("virwork",T)}};this.sendKeyEvent=function(P,Q){if(!z()){return}J.i(P+"-key:"+Q);h.sendMessage("key",Q,P)};this.sendMouseState=function(Q){if(!z()){return}if(typeof Math.floor(Q.x)!="number"){return}if(typeof Math.floor(Q.y)!="number"){return}v.moveCursor(Math.floor(Q.x),Math.floor(Q.y));var P=0;if(Q.left){P|=1}if(Q.middle){P|=2}if(Q.right){P|=4}if(Q.up){P|=8}if(Q.down){P|=16}h.sendMessage("mouse",Math.floor(Q.x),Math.floor(Q.y),P)};this.setClipboard=function(R){if(!z()){return}var S=n.createClipboardStream("text/plain");var Q=new VvWork.StringWriter(S);for(var P=0;P<R.length;P+=4096){Q.sendText(R.substring(P,P+4096))}Q.sendEnd()};this.createOutputStream=function m(){var P=H.next();var Q=N[P]=new VvWork.OutputStream(n,P);return Q};this.createAudioStream=function(P){var Q=n.createOutputStream();h.sendMessage("audio",Q.index,P);return Q};this.createFileStream=function(P,Q){var R=n.createOutputStream();h.sendMessage("file",R.index,P,Q);return R};this.createPipeStream=function(P,Q){var R=n.createOutputStream();h.sendMessage("pipe",R.index,P,Q);return R};this.createClipboardStream=function(P){var Q=n.createOutputStream();h.sendMessage("clipboard",Q.index,P);return Q};this.createObjectOutputStream=function r(R,P,Q){var S=n.createOutputStream();h.sendMessage("put",R,S.index,P,Q);return S};this.requestObjectInputStream=function d(Q,P){if(!z()){return}h.sendMessage("get",Q,P)};this.sendAck=function(P,R,Q){if(!z()){return}h.sendMessage("ack",P,R,Q)};this.sendBlob=function(P,Q){if(!z()){return}h.sendMessage("blob",P,Q)};this.endStream=function(P){if(!z()){return}h.sendMessage("end",P);if(N[P]){H.free(P);delete N[P]}};this.onstatechange=null;this.onname=null;this.onerror=null;this.onaudio=null;this.onvideo=null;this.onclipboard=null;this.onfile=null;this.onfilesystem=null;this.onpipe=null;this.onsync=null;var b=function b(P){var Q=C[P];if(!Q){if(P===0){Q=v.getDefaultLayer()}else{if(P>0){Q=v.createLayer()}else{Q=v.createBuffer()}}C[P]=Q}return Q};var o=function o(Q){if(!Q){return null}for(var P in C){if(Q===C[P]){return parseInt(P)}}return null};function g(P){var Q=l[P];if(Q==null){Q=l[P]=new VvWork.Parser();Q.oninstruction=h.oninstruction}return Q}var a={"miter-limit":function(P,Q){v.setMiterLimit(P,parseFloat(Q))}};var f={ack:function(Q){var T=parseInt(Q[0]);var R=Q[1];var P=parseInt(Q[2]);var S=N[T];if(S){if(S.onack){S.onack(new VvWork.Status(P,R))}if(P>=256){H.free(T);delete N[T]}}},arc:function(V){var U=b(parseInt(V[0]));var Q=parseInt(V[1]);var W=parseInt(V[2]);var P=parseInt(V[3]);var T=parseFloat(V[4]);var R=parseFloat(V[5]);var S=parseInt(V[6]);v.arc(U,Q,W,P,T,R,S!=0)},audio:function(R){var T=parseInt(R[0]);var Q=R[1];var S=s[T]=new VvWork.InputStream(n,T);var P=null;if(n.onaudio){P=n.onaudio(S,Q)}if(!P){P=VvWork.AudioPlayer.getInstance(S,Q)}if(P){x[T]=P;n.sendAck(T,"OK",0)}else{n.sendAck(T,"BAD TYPE",783)}},blob:function(P){var S=parseInt(P[0]);var Q=P[1];var R=s[S];if(R&&R.onblob){R.onblob(Q)}},body:function i(S){var T=parseInt(S[0]);var R=D[T];var V=parseInt(S[1]);var P=S[2];var Q=S[3];if(R&&R.onbody){var U=s[V]=new VvWork.InputStream(n,V);R.onbody(U,P,Q)}else{n.sendAck(V,"Receipt of body unsupported",256)}},cfill:function(U){var V=parseInt(U[0]);var R=b(parseInt(U[1]));var T=parseInt(U[2]);var S=parseInt(U[3]);var P=parseInt(U[4]);var Q=parseInt(U[5]);v.setChannelMask(R,V);v.fillColor(R,T,S,P,Q)},clip:function(Q){var P=b(parseInt(Q[0]));v.clip(P)},clipboard:function(Q){var S=parseInt(Q[0]);var P=Q[1];if(n.onclipboard){var R=s[S]=new VvWork.InputStream(n,S);n.onclipboard(R,P)}else{n.sendAck(S,"Clipboard unsupported",256)}},close:function(Q){J.e("close?");var P=b(parseInt(Q[0]));v.close(P)},copy:function(X){var P=b(parseInt(X[0]));var T=parseInt(X[1]);var S=parseInt(X[2]);var R=parseInt(X[3]);var Y=parseInt(X[4]);var W=parseInt(X[5]);var Q=b(parseInt(X[6]));var V=parseInt(X[7]);var U=parseInt(X[8]);v.setChannelMask(Q,W);v.copy(P,T,S,R,Y,Q,V,U)},cstroke:function(X){var U=parseInt(X[0]);var S=b(parseInt(X[1]));var Y=k[parseInt(X[2])];var Q=M[parseInt(X[3])];var W=parseInt(X[4]);var P=parseInt(X[5]);var R=parseInt(X[6]);var T=parseInt(X[7]);var V=parseInt(X[8]);v.setChannelMask(S,U);v.strokeColor(S,Y,Q,W,P,R,T,V)},cursor:function(W){var V=parseInt(W[0]);var U=parseInt(W[1]);var S=b(parseInt(W[2]));var Q=parseInt(W[3]);var P=parseInt(W[4]);var T=parseInt(W[5]);var R=parseInt(W[6]);v.setCursor(V,U,S,Q,P,T,R)},curve:function(V){var U=b(parseInt(V[0]));var R=parseInt(V[1]);var Q=parseInt(V[2]);var T=parseInt(V[3]);var S=parseInt(V[4]);var P=parseInt(V[5]);var W=parseInt(V[6]);v.curveTo(U,R,Q,T,S,P,W)},disconnect:function e(P){J.e("recive disconnect.");n.disconnect()},dispose:function(R){var P=parseInt(R[0]);if(P>0){var Q=b(P);v.dispose(Q);delete C[P]}else{if(P<0){delete C[P]}}},distort:function(X){var P=parseInt(X[0]);var W=parseFloat(X[1]);var V=parseFloat(X[2]);var U=parseFloat(X[3]);var T=parseFloat(X[4]);var S=parseFloat(X[5]);var R=parseFloat(X[6]);if(P>=0){var Q=b(P);v.distort(Q,W,V,U,T,S,R)}},error:function(Q){var R=Q[0];var P=parseInt(Q[1]);if(n.onerror){n.onerror(new VvWork.Status(P,R))}n.disconnect()},end:function(P){var R=parseInt(P[0]);var Q=s[R];if(Q){if(Q.onend){Q.onend()}delete s[R]}},file:function(R){var T=parseInt(R[0]);var P=R[1];var Q=R[2];if(n.onfile){var S=s[T]=new VvWork.InputStream(n,T);n.onfile(S,P,Q)}else{n.sendAck(T,"File transfer unsupported",256)}},filesystem:function B(R){var S=parseInt(R[0]);var Q=R[1];if(n.onfilesystem){var P=D[S]=new VvWork.Object(n,S);n.onfilesystem(P,Q)}},identity:function(Q){var P=b(parseInt(Q[0]));v.setTransform(P,1,0,0,1,0,0)},img:function(Y){var P=parseInt(Y[0]);var T=parseInt(Y[1]);var S=b(parseInt(Y[2]));var V=Y[3];var W=parseInt(Y[4]);var U=parseInt(Y[5]);var X=s[P]=new VvWork.InputStream(n,P);var R=new VvWork.DataURIReader(X,V);R.onend=function Q(){v.setChannelMask(S,T);v.draw(S,W,U,R.getURI())}},jpeg:function(R){var U=parseInt(R[0]);var Q=b(parseInt(R[1]));var P=parseInt(R[2]);var T=parseInt(R[3]);var S=R[4];v.setChannelMask(Q,U);v.draw(Q,P,T,"data:image/jpeg;base64,"+S)},lfill:function(R){var S=parseInt(R[0]);var Q=b(parseInt(R[1]));var P=b(parseInt(R[2]));v.setChannelMask(Q,S);v.fillLayer(Q,P)},line:function(R){var Q=b(parseInt(R[0]));var P=parseInt(R[1]);var S=parseInt(R[2]);v.lineTo(Q,P,S)},lstroke:function(R){var S=parseInt(R[0]);var Q=b(parseInt(R[1]));var P=b(parseInt(R[2]));v.setChannelMask(Q,S);v.strokeLayer(Q,P)},mouse:function O(Q){var P=parseInt(Q[0]);var R=parseInt(Q[1]);v.showCursor(true);v.moveCursor(P,R)},move:function(U){var Q=parseInt(U[0]);var R=parseInt(U[1]);var P=parseInt(U[2]);var W=parseInt(U[3]);var V=parseInt(U[4]);if(Q>0&&R>=0){var S=b(Q);var T=b(R);v.move(S,T,P,W,V)}},name:function(P){if(n.onname){n.onname(P[0])}},desktop:function(P){if(n.isDesktop){n.isDesktop(P)}},sso:function(P){if(n.isSSO){n.isSSO(P)}},token_id:function(P){if(n.token_id){n.token_id(P)}},opened:function(P){},destroystate:function(P){if(n.destroystate){n.destroystate(P)}},display_scale:function(P){J.i("display scale(create tunnel):"+P);if(n.display_scale){n.display_scale(P)}},display_width:function(P){J.i("display_width："+P);if(n.display_width){n.display_width(P)}},display_height:function(P){J.i("display_height："+P);if(n.display_height){n.display_height(P)}},nest:function(P){var Q=g(parseInt(P[0]));Q.receive(P[1])},pipe:function(R){var T=parseInt(R[0]);var P=R[1];var Q=R[2];if(n.onpipe){var S=s[T]=new VvWork.InputStream(n,T);n.onpipe(S,P,Q)}else{n.sendAck(T,"Named pipes unsupported",256)}},png:function(R){var U=parseInt(R[0]);var Q=b(parseInt(R[1]));var P=parseInt(R[2]);var T=parseInt(R[3]);var S=R[4];v.setChannelMask(Q,U);v.draw(Q,P,T,"data:image/png;base64,"+S)},pop:function(Q){var P=b(parseInt(Q[0]));v.pop(P)},push:function(Q){var P=b(parseInt(Q[0]));v.push(P)},rect:function(T){var R=b(parseInt(T[0]));var P=parseInt(T[1]);var U=parseInt(T[2]);var Q=parseInt(T[3]);var S=parseInt(T[4]);v.rect(R,P,U,Q,S)},reset:function(Q){var P=b(parseInt(Q[0]));v.reset(P)},set:function(S){var Q=b(parseInt(S[0]));var P=S[1];var T=S[2];var R=a[P];if(R){R(Q,T)}},shade:function(S){var P=parseInt(S[0]);var Q=parseInt(S[1]);if(P>=0){var R=b(P);v.shade(R,Q)}},size:function(T){var Q=parseInt(T[0]);var R=b(Q);var S=parseInt(T[1]);var P=parseInt(T[2]);v.resize(R,S,P)},start:function(R){var Q=b(parseInt(R[0]));var P=parseInt(R[1]);var S=parseInt(R[2]);v.moveTo(Q,P,S)},sync:function(Q){var R=parseInt(Q[0]);if(R==0){return}J.e("client sync:timestamp="+R);v.flush(function P(){for(var T in x){var S=x[T];if(S){S.sync()}}if(R!==F){J.e("send sync(flush):"+R);h.sendMessage("sync",R);F=R}});if(t===A){I(y)}if(n.onsync){n.onsync(R)}},transfer:function(X){var P=b(parseInt(X[0]));var U=parseInt(X[1]);var T=parseInt(X[2]);var S=parseInt(X[3]);var Y=parseInt(X[4]);var R=parseInt(X[5]);var Q=b(parseInt(X[6]));var W=parseInt(X[7]);var V=parseInt(X[8]);if(R===3){v.put(P,U,T,S,Y,Q,W,V)}else{if(R!==5){v.transfer(P,U,T,S,Y,Q,W,V,VvWork.Client.DefaultTransferFunction[R])}}},transform:function(S){var R=b(parseInt(S[0]));var Q=parseFloat(S[1]);var P=parseFloat(S[2]);var W=parseFloat(S[3]);var V=parseFloat(S[4]);var U=parseFloat(S[5]);var T=parseFloat(S[6]);v.transform(R,Q,P,W,V,U,T)},undefine:function K(Q){var R=parseInt(Q[0]);var P=D[R];if(P&&P.onundefine){P.onundefine()}},video:function(S){var U=parseInt(S[0]);var Q=b(parseInt(S[1]));var P=S[2];var T=s[U]=new VvWork.InputStream(n,U);var R=null;if(n.onvideo){R=n.onvideo(T,Q,P)}if(!R){R=VvWork.VideoPlayer.getInstance(T,Q,P)}if(R){G[U]=R;n.sendAck(U,"OK",0)}else{n.sendAck(U,"BAD TYPE",783)}}};h.oninstruction=function(R,Q){var P=f[R];if(P){P(Q)}};this.disconnect=function(){if(t!=L&&t!=p){I(p);J.i("client send disconnect message and disconnect.");h.sendMessage("disconnect");h.disconnect();I(L)}if(u){J.i("stop ping.");window.clearInterval(u);u=null}};this.connect=function(Q){I(c);try{h.connect(Q)}catch(P){I(w);throw P}u=window.setInterval(function(){if(!z()){if(u){window.clearInterval(u);u=null}}else{h.sendMessage("sync",F)}},5000);I(A)}};VvWork.Client.DefaultTransferFunction={0:function(a,b){b.red=b.green=b.blue=0},15:function(a,b){b.red=b.green=b.blue=255},3:function(a,b){b.red=a.red;b.green=a.green;b.blue=a.blue;b.alpha=a.alpha},5:function(a,b){},12:function(a,b){b.red=255&~a.red;b.green=255&~a.green;b.blue=255&~a.blue;b.alpha=a.alpha},10:function(a,b){b.red=255&~b.red;b.green=255&~b.green;b.blue=255&~b.blue},1:function(a,b){b.red=(a.red&b.red);b.green=(a.green&b.green);b.blue=(a.blue&b.blue)},14:function(a,b){b.red=255&~(a.red&b.red);b.green=255&~(a.green&b.green);b.blue=255&~(a.blue&b.blue)},7:function(a,b){b.red=(a.red|b.red);b.green=(a.green|b.green);b.blue=(a.blue|b.blue)},8:function(a,b){b.red=255&~(a.red|b.red);b.green=255&~(a.green|b.green);b.blue=255&~(a.blue|b.blue)},6:function(a,b){b.red=(a.red^b.red);b.green=(a.green^b.green);b.blue=(a.blue^b.blue)},9:function(a,b){b.red=255&~(a.red^b.red);b.green=255&~(a.green^b.green);b.blue=255&~(a.blue^b.blue)},4:function(a,b){b.red=255&(~a.red&b.red);b.green=255&(~a.green&b.green);b.blue=255&(~a.blue&b.blue)},13:function(a,b){b.red=255&(~a.red|b.red);b.green=255&(~a.green|b.green);b.blue=255&(~a.blue|b.blue)},2:function(a,b){b.red=255&(a.red&~b.red);b.green=255&(a.green&~b.green);b.blue=255&(a.blue&~b.blue)},11:function(a,b){b.red=255&(a.red|~b.red);b.green=255&(a.green|~b.green);b.blue=255&(a.blue|~b.blue)}};var VvWork=VvWork||{};VvWork.DataURIReader=function(g,b){var f=this;var e="data:"+b+";base64,";g.onblob=function a(h){e+=h};g.onend=function c(){if(f.onend){f.onend()}};this.getURI=function d(){return e};this.onend=null};var VvWork=VvWork||{};VvWork.Display=function(k){var I=new VvWork.Logger();var u=this;var j=0;var w=0;var i=window.innerWidth;var D=window.innerHeight;var H=1;if(!!!!k){H=k.lastScale}var g=document.createElement("div");g.className="client-view-ui";g.style.position="fixed";var v=document.createElement("div");v.className="client-view-mouse-point";var p=document.createElement("canvas");p.className="client-view-whirl";var n=document.createElement("canvas");n.className="client-view-ripple";var C=document.createElement("canvas");C.className="client-view-cursor";var h=document.createElement("canvas");h.className="client-watermark";h.style.display="none";h.style.visibility="hidden";var M=document.createElement("div");M.className="client-view-scroller";var a=document.createElement("canvas");a.className="client-view-sso";var c=96;var F=window.innerWidth;var K=window.innerHeight;a.style.width=F+"px";n.style.width=p.style.width=c+"px";a.width=F;n.width=p.width=c;a.style.height=K+"px";n.style.height=p.style.height=c+"px";a.height=K;n.height=p.height=c;C.width=C.height=32;M.width=42;M.height=192;M.style.width=42+"px";M.style.height=192+"px";M.style.display="none";M.style.visibility="hidden";var s=document.createElement("div");s.style.position="relative";s.style.width=j+"px";s.style.height=w+"px";s.style.transformOrigin=s.style.webkitTransformOrigin=s.style.MozTransformOrigin=s.style.OTransformOrigin=s.style.msTransformOrigin="0 0";var J=new VvWork.Display.VisibleLayer(j,w);var e=new VvWork.Display.VisibleLayer(0,0);e.setChannelMask(VvWork.Layer.SRC);s.appendChild(J.getElement());s.appendChild(e.getElement());var A=document.createElement("div");A.style.position="relative";A.style.width=(j*H)+"px";A.style.height=(w*H)+"px";g.appendChild(h);g.appendChild(a);g.appendChild(v);g.appendChild(p);g.appendChild(n);g.appendChild(C);g.appendChild(M);function E(N){}function b(N){N.stopPropagation();if(N.preventDefault){N.preventDefault()}N.returnValue=false}v.addEventListener("touchmove",E,false);v.addEventListener("touchstart",E,false);v.addEventListener("touchend",E,false);p.addEventListener("touchmove",E,false);p.addEventListener("touchstart",E,false);p.addEventListener("touchend",E,false);n.addEventListener("touchmove",E,false);n.addEventListener("touchstart",E,false);n.addEventListener("touchend",E,false);C.addEventListener("touchmove",E,false);C.addEventListener("touchstart",E,false);C.addEventListener("touchend",E,false);M.addEventListener("touchmove",b,false);M.addEventListener("touchstart",b,false);M.addEventListener("touchend",b,false);A.appendChild(g);A.appendChild(s);var t=function(T){var R=this;var S=false;var O=96;this.resize=function(V,U){};var N=function(){return T};var Q=null;var P=null;this.isDelay=function(){return S};this.move=function(V,Y){var U=96;var X="translate("+(V-T.parentNode.parentNode.offsetLeft-U/2)+"px, "+(Y-T.parentNode.parentNode.offsetTop-U/2)+"px)";var W="matrix(1, 0, 0, 1, 0, 0)";T.style.transform=T.style.WebkitTransform=T.style.MozTransform=T.style.OTransform=T.style.msTransform=X+" "+W};this.drawToLayer=function(V,aa){V=O/2;aa=O/2;R.hide();T.style.display="block";T.style.visibility="visible";var Y=N().getContext("2d");Y.clearRect(0,0,window.innerWidth,window.innerHeight);var U=new Array();for(var Z=O/2;Z>=2;Z-=3){U.push(Z)}var X=0;var W=["#3c3f41","#d5dadd"];W=["rgba(0, 0, 0, 0.66)","rgba(0, 0, 0, 0.36)"];P=window.setTimeout(function(){Q=window.setInterval(function(){if(X<U.length){Y.clearRect(0,0,window.innerWidth,window.innerHeight);Y.beginPath();var ab=W[0];var ac=1;if(X%2==0){ab=W[1];ac=1}Y.arc(V,aa,U[X++],0,2*Math.PI);Y.strokeStyle=ab;Y.lineWidth=ac;Y.fillStyle=ab;Y.fill();Y.stroke()}else{S=true;start=false;window.clearInterval(Q);Q=null;R.hide()}},20)},U.length*10)};this.hide=function(){T.style.display="none";T.style.visibility="hidden";window.clearTimeout(P);P=null;window.clearInterval(Q);Q=null;S=false}};var B=function(Q){var X=this;var V=false;var U=96;var P=(U/2)-5;var T=null;var O=50;var N=null;var W=500;var S=function(){return Q};this.isFinished=false;this.resize=function(Y,R){};this.drawToLayer=function(R,ae){R=U/2;ae=U/2;X.hide();X.isFinished=V=false;Q.style.display="block";Q.style.visibility="visible";var Y=S().getContext("2d");Y.clearRect(0,0,window.innerWidth,window.innerHeight);var ab=5;var ac=Math.PI/ab;var Z=2*ab;var ad=2*ab;var aa=5;N=window.setTimeout(function(){T=window.setInterval(function(){if(Z>0){var af=R+Math.cos(ac*Z+Math.PI/2+Math.PI/ab)*P;var ag=ae-Math.sin(ac*Z+Math.PI/2+Math.PI/ab)*P;Y.beginPath();if(Z>ab){Y.arc(af,ag,aa*((Z/ab)-1),0,Math.PI*2,false)}else{if(Z==ab){Y.arc(af,ag,aa,0,Math.PI*2,false)}else{Y.arc(af,ag,aa*((ad/ab)-1),0,Math.PI*2,false);ad--}}Y.fillStyle="#2edaff";Y.strokeStyle="#2edaff";Y.fill();Y.stroke();Y.save();Z--}else{X.isFinished=V=true;window.clearInterval(T);T=null}},O)},W-O)};this.hide=function(){if(!!!Q){init()}X.isFinished=V=false;window.clearInterval(T);T=null;window.clearTimeout(N);N=null;Q.style.display="none";Q.style.visibility="hidden"}};var f=function(Q){var P=this;this.x=window.innerWidth/2;this.y=window.innerHeight/2;this.resetState=function(S,U,T){P.x=S;P.y=U;if(T){P.show()}else{P.hide()}};var O=function(){var S=Q.getContext("2d");S.clearRect(0,0,window.innerWidth,window.innerHeight);var T=e.getCanvas();if(!!!!T){S.drawImage(T,0,0)}};this.copyLayout=function(){O()};this.show=function(){O();P.hide()};this.hide=function(){Q.style.display="none";Q.style.visibility="hidden"};var R=32;var N=32;this.move=function(S,T){P.x=S;P.y=T};this.screenCursorX=0;this.screenCursorY=0;this.setTransform=function(S,V){var U="translate("+(P.x)+"px, "+(P.y)+"px)";var T="matrix(1, 0, 0, 1, 0, 0)";Q.style.transform=Q.style.WebkitTransform=Q.style.MozTransform=Q.style.OTransform=Q.style.msTransform=U+" "+T};this.getElement=function(){return Q};return P};var L=function(O){var N=this;this.hide=function(){O.style.display="none";O.style.visibility="hidden"};this.display=function(){O.style.display="block";O.style.visibility="visible"};this.show=function(S,Q){var P=S-42;var U=(Q-192)/2;var T="translate("+(P)+"px, "+(U)+"px)";var R="matrix(1, 0, 0, 1, 0, 0)";O.style.transform=O.style.WebkitTransform=O.style.MozTransform=O.style.OTransform=O.style.msTransform=T+" "+R;O.style.display="block";O.style.visibility="visible"};this.getElement=function(){return O};return N};this.myRipple=new t(n);this.myWhirl=new B(p);this.myCursor=new f(C);this.myScrooler=new L(M);this.setUiToolsDisplaySize=function(O,N){g.style.width=O+"px";g.width=O;g.style.height=N+"px";g.height=N};this.showMousePoint=function(N){if(N){v.style.display="block";v.style.visibility="visible"}else{v.style.display="none";v.style.visibility="hidden"}};this.moveMousePoint=function(N,R){var P=8;var Q="translate("+(N-v.parentNode.parentNode.offsetLeft-P)+"px, "+(R-v.parentNode.parentNode.offsetTop-P)+"px)";var O="matrix(1, 0, 0, 1, 0, 0)";v.style.transform=v.style.WebkitTransform=v.style.MozTransform=v.style.OTransform=v.style.msTransform=Q+" "+O};this.moveMouseRipple=function(O,R){var N=96;var Q="translate("+(O-n.parentNode.parentNode.offsetLeft-N/2)+"px, "+(R-n.parentNode.parentNode.offsetTop-N/2)+"px)";var P="matrix(1, 0, 0, 1, 0, 0)";n.style.transform=n.style.WebkitTransform=n.style.MozTransform=n.style.OTransform=n.style.msTransform=Q+" "+P};this.moveMouseWhirl=function(O,R){var N=96;var Q="translate("+(O-p.parentNode.parentNode.offsetLeft-N/2)+"px, "+(R-p.parentNode.parentNode.offsetTop-N/2)+"px)";var P="matrix(1, 0, 0, 1, 0, 0)";p.style.transform=p.style.WebkitTransform=p.style.MozTransform=p.style.OTransform=p.style.msTransform=Q+" "+P};this.moveVirworkCursor=function(N,O){u.myCursor.move(N,O)};this.showVirworkCursor=function(N){if(N){u.myCursor.show()}else{u.myCursor.hide()}};this.updateVirworkCursor=function(){u.myCursor.copyLayout()};this.cursorHotspotX=0;this.cursorHotspotY=0;this.cursorX=0;this.cursorY=0;this.transformX=0;this.transformY=0;this.keyboardStatus=0;this.onresize=null;this.oncursor=null;var z=[];var q=[];function d(){var N=0;while(N<q.length){var O=q[N];if(!O.isReady()){break}O.flush();N++}q.splice(0,N)}function G(O,N){this.isReady=function(){for(var P=0;P<N.length;P++){if(N[P].blocked){return false}}return true};this.flush=function(){for(var P=0;P<N.length;P++){N[P].execute()}if(O){O()}}}function x(P,O){var N=this;this.blocked=O;this.unblock=function(){if(N.blocked){N.blocked=false;d()}};this.execute=function(){if(P){P()}}}function y(P,O){var N=new x(P,O);z.push(N);return N}this.getElement=function(){return A};this.getWidth=function(){return j};this.getHeight=function(){return w};this.getDefaultLayer=function(){return J};this.getCursorLayer=function(){return e};this.createLayer=function(){var N=new VvWork.Display.VisibleLayer(j,w);N.move(J,0,0,0);return N};this.createBuffer=function(){var N=new VvWork.Layer(0,0);N.autosize=1;return N};this.flush=function(N){q.push(new G(N,z));z=[];d()};this.setCursor=function(T,R,S,O,N,Q,U){y(function P(){u.cursorHotspotX=T;u.cursorHotspotY=R;e.resize(Q,U);e.copy(S,O,N,Q,U,0,0);u.moveCursor(u.cursorX,u.cursorY);if(u.oncursor){u.oncursor(e.toCanvas(),T,R)}u.myCursor.copyLayout()})};this.showCursor=function(P){var N=e.getElement();var O=N.parentNode;if(P===false){if(O){N.style.display="none";N.style.visibility="hidden"}}else{if(O!==s){s.appendChild(N);N.style.display="block";N.style.visibility="visible"}else{s.appendChild(N);N.style.display="block";N.style.visibility="visible"}}};this.moveCursor=function(N,O){e.translate(N-u.cursorHotspotX,O-u.cursorHotspotY);u.cursorX=N;u.cursorY=O};this.resize=function(O,P,N){y(function Q(){O.resize(P,N);if(O===J){j=P;w=N;s.style.width=j+"px";s.style.height=w+"px";A.style.width=(j*H)+"px";A.style.height=(w*H)+"px";u.setUiToolsDisplaySize(j*H,w*H);if(u.onresize){u.onresize(P,N)}}})};this.drawImage=function(P,N,R,Q){y(function O(){P.drawImage(N,R,Q)})};this.drawBlob=function(S,O,U,Q){var R=URL.createObjectURL(Q);var P=y(function N(){if(T.width&&T.height){S.drawImage(O,U,T)}URL.revokeObjectURL(R)},true);var T=new Image();T.onload=P.unblock;T.onerror=P.unblock;T.src=R};this.draw=function(R,N,T,Q){var P=y(function O(){if(S.width&&S.height){R.drawImage(N,T,S)}},true);var S=new Image();S.onload=P.unblock;S.onerror=P.unblock;S.src=Q};this.play=function(P,N,R,O){var Q=document.createElement("video");Q.type=N;Q.src=O;Q.addEventListener("play",function(){function S(){P.drawImage(0,0,Q);if(!Q.ended){window.setTimeout(S,20)}}S()},false);y(Q.play)};this.transfer=function(T,O,N,P,W,R,U,S,Q){y(function V(){R.transfer(T,O,N,P,W,U,S,Q)})};this.put=function(T,O,N,P,V,R,U,S){y(function Q(){R.put(T,O,N,P,V,U,S)})};this.copy=function(T,O,N,P,V,Q,U,S){y(function R(){Q.copy(T,O,N,P,V,U,S)})};this.moveTo=function(P,N,Q){y(function O(){P.moveTo(N,Q)})};this.lineTo=function(P,N,Q){y(function O(){P.lineTo(N,Q)})};this.arc=function(T,O,U,N,S,P,R){y(function Q(){T.arc(O,U,N,S,P,R)})};this.curveTo=function(S,P,O,R,Q,N,U){y(function T(){S.curveTo(P,O,R,Q,N,U)})};this.close=function(N){y(function O(){N.close()})};this.rect=function(P,N,S,O,Q){y(function R(){P.rect(N,S,O,Q)})};this.clip=function(N){y(function O(){N.clip()})};this.strokeColor=function(Q,U,O,S,N,P,R,T){y(function V(){Q.strokeColor(U,O,S,N,P,R,T)})};this.fillColor=function(P,R,Q,N,O){y(function S(){P.fillColor(R,Q,N,O)})};this.strokeLayer=function(R,Q,S,P,O){y(function N(){R.strokeLayer(Q,S,P,O)})};this.fillLayer=function(O,N){y(function P(){O.fillLayer(N)})};this.push=function(O){y(function N(){O.push()})};this.pop=function(O){y(function N(){O.pop()})};this.reset=function(N){y(function O(){N.reset()})};this.setTransform=function(P,O,N,U,S,R,Q){y(function T(){P.setTransform(O,N,U,S,R,Q)})};this.transform=function(Q,P,N,U,T,S,R){y(function O(){Q.transform(P,N,U,T,S,R)})};this.setChannelMask=function(O,N){y(function P(){O.setChannelMask(N)})};this.setMiterLimit=function(P,N){y(function O(){P.setMiterLimit(N)})};this.dispose=function r(N){y(function O(){N.dispose()})};this.distort=function m(P,O,N,U,T,S,R){y(function Q(){P.distort(O,N,U,T,S,R)})};this.move=function o(O,P,N,S,R){y(function Q(){O.move(P,N,S,R)})};this.shade=function l(O,P){y(function N(){O.shade(P)})};this.scale=function(N){s.style.transform=s.style.WebkitTransform=s.style.MozTransform=s.style.OTransform=s.style.msTransform="scale("+N+","+N+")";H=N;A.style.width=(j*H)+"px";A.style.height=(w*H)+"px";u.setUiToolsDisplaySize(j*H,w*H)};this.getScale=function(){return H};this.flatten=function(){var O=document.createElement("canvas");O.width=J.width;O.height=J.height;var P=O.getContext("2d");function N(U){var T=[];for(var S in U.children){T.push(U.children[S])}T.sort(function R(Y,X){var Z=Y.z-X.z;if(Z!==0){return Z}var W=Y.getElement();var aa=X.getElement();var V=aa.compareDocumentPosition(W);if(V&Node.DOCUMENT_POSITION_PRECEDING){return -1}if(V&Node.DOCUMENT_POSITION_FOLLOWING){return 1}return 0});return T}function Q(V,S,X){if(V.width>0&&V.height>0){var R=P.globalAlpha;P.globalAlpha*=V.alpha/255;P.drawImage(V.getCanvas(),S,X);var U=N(V);for(var T=0;T<U.length;T++){var W=U[T];Q(W,S+W.x,X+W.y)}P.globalAlpha=R}}Q(J,0,0);return O}};VvWork.Display.VisibleLayer=function(b,i){var e=new VvWork.Logger();VvWork.Layer.apply(this,[b,i]);var f=this;this.__unique_id=VvWork.Display.VisibleLayer.__next_id++;this.alpha=255;this.x=0;this.y=0;this.z=0;this.matrix=[1,0,0,1,0,0];this.parent=null;this.children={};var c=f.getCanvas();c.style.position="absolute";c.style.left="0px";c.style.top="0px";var a=document.createElement("div");a.appendChild(c);a.style.width=b+"px";a.style.height=i+"px";a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.overflow="hidden";var g=this.resize;this.resize=function(k,j){a.style.width=k+"px";a.style.height=j+"px";g(k,j)};this.getElement=function(){return a};var d="translate(0px, 0px)";var h="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(j,k){f.x=j;f.y=k;d="translate("+j+"px,"+k+"px)";a.style.transform=a.style.WebkitTransform=a.style.MozTransform=a.style.OTransform=a.style.msTransform=d+" "+h};this.move=function(k,j,n,m){if(f.parent!==k){if(f.parent){delete f.parent.children[f.__unique_id]}f.parent=k;k.children[f.__unique_id]=f;var l=k.getElement();l.appendChild(a)}f.translate(j,n);f.z=m;a.style.zIndex=m};this.shade=function(j){f.alpha=j;a.style.opacity=j/255};this.dispose=function(){if(f.parent){delete f.parent.children[f.__unique_id];f.parent=null}if(a.parentNode){a.parentNode.removeChild(a)}};this.distort=function(k,j,o,n,m,l){f.matrix=[k,j,o,n,m,l];h="matrix("+k+","+j+","+o+","+n+","+m+","+l+")";a.style.transform=a.style.WebkitTransform=a.style.MozTransform=a.style.OTransform=a.style.msTransform=d+" "+h}};VvWork.Display.VisibleLayer.__next_id=0;var VvWork=VvWork||{};VvWork.InputSink=function InputSink(){var g=this;var c=document.createElement("textarea");c.style.position="fixed";c.style.outline="none";c.style.border="none";c.style.margin="0";c.style.padding="0";c.style.height="0";c.style.width="0";c.style.left="0";c.style.bottom="0";c.style.resize="none";c.style.background="transparent";c.style.color="transparent";c.addEventListener("keypress",function h(j){c.value=""},false);c.addEventListener("compositionend",function e(j){if(j.data){c.value=""}},false);c.addEventListener("input",function b(j){if(j.data&&!j.isComposing){c.value=""}},false);c.addEventListener("focus",function f(){window.setTimeout(function j(){c.click();c.select()},0)},true);this.focus=function i(){window.setTimeout(function j(){c.focus()},0)};this.getElement=function a(){return c};document.addEventListener("keydown",function d(l){var k=document.activeElement;if(k&&k!==document.body){var j=k.getBoundingClientRect();if(j.left+j.width>0&&j.top+j.height>0){return}}g.focus()},true)};var VvWork=VvWork||{};VvWork.InputStream=function(a,b){var c=this;this.index=b;this.onblob=null;this.onend=null;this.sendAck=function(e,d){a.sendAck(c.index,e,d)}};var VvWork=VvWork||{};VvWork.IntegerPool=function(){var b=this;var a=[];this.next_int=0;this.next=function(){if(a.length>0){return a.shift()}return b.next_int++};this.free=function(c){a.push(c)}};var VvWork=VvWork||{};VvWork.JSONReader=function vvw_ReaderorkJSONReader(g){var d=this;var f=new vvw_Readerork.StringReader(g);var b="";this.getLength=function a(){return b.length};this.getJSON=function c(){return JSON.parse(b)};f.ontext=function h(i){b+=i;if(d.onprogress){d.onprogress(i.length)}};f.onend=function e(){if(d.onend){d.onend()}};this.onprogress=null;this.onend=null};var VvWork=VvWork||{};VvWork.Keyboard=function(c){var i=this;this.onkeydown=null;this.onkeyup=null;var v=function(){var A=this;this.timestamp=new Date().getTime();this.defaultPrevented=false;this.keysym=null;this.reliable=false;this.getAge=function(){return new Date().getTime()-A.timestamp}};var w=function(F,E,C,A){v.apply(this);this.keyCode=F;this.keyIdentifier=E;this.key=C;this.location=A;this.keysym=y(C,A)||h(F,A);if(this.keysym&&!s(this.keysym)){this.reliable=true}if(!this.keysym&&e(F,E)){this.keysym=y(E,A,i.modifiers.shift)}var B=!i.modifiers.ctrl&&!(navigator&&navigator.platform&&navigator.platform.match(/^mac/i));var D=!i.modifiers.alt;if((D&&i.modifiers.ctrl)||(B&&i.modifiers.alt)||i.modifiers.meta||i.modifiers.hyper){this.reliable=true}k[F]=this.keysym};w.prototype=new v();var b=function(A){v.apply(this);this.charCode=A;this.keysym=q(A);this.reliable=true};b.prototype=new v();var j=function(D,C,B,A){v.apply(this);this.keyCode=D;this.keyIdentifier=C;this.key=B;this.location=A;this.keysym=k[D]||h(D,A)||y(B,A);this.reliable=true};j.prototype=new v();var z=[];var u={8:[65288],9:[65289],12:[65291,65291,65291,65461],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365,65365,65365,65465],34:[65366,65366,65366,65459],35:[65367,65367,65367,65457],36:[65360,65360,65360,65463],37:[65361,65361,65361,65460],38:[65362,65362,65362,65464],39:[65363,65363,65363,65462],40:[65364,65364,65364,65458],45:[65379,65379,65379,65456],46:[65535,65535,65535,65454],91:[65515],92:[65383],93:null,96:[65456],97:[65457],98:[65458],99:[65459],100:[65460],101:[65461],102:[65462],103:[65463],104:[65464],105:[65465],106:[65450],107:[65451],109:[65453],110:[65454],111:[65455],112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]};var f={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],DeadGrave:[65104],DeadAcute:[65105],DeadCircumflex:[65106],DeadTilde:[65107],DeadMacron:[65108],DeadBreve:[65109],DeadAboveDot:[65110],DeadUmlaut:[65111],DeadAboveRing:[65112],DeadDoubleacute:[65113],DeadCaron:[65114],DeadCedilla:[65115],DeadOgonek:[65116],DeadIota:[65117],DeadVoicedSound:[65118],DeadSemivoicedSound:[65119],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[64797],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],Up:[65362],Undo:[65381],Win:[65515],Zenkaku:[65320],ZenkakuHankaku:[65322]};var r={65027:true,65505:true,65506:true,65507:true,65508:true,65511:true,65512:true,65513:true,65514:true,65515:true,65516:true};this.modifiers=new VvWork.Keyboard.ModifierState();this.pressed={};var n={};var k={};var d=null;var o=null;var l=function l(B,A){if(!B){return null}return B[A]||B[0]};var s=function s(A){return(A>=0&&A<=255)||(A&4294901760)===16777216};function y(C,B,F){if(!C){return null}var E;var A=C.indexOf("U+");if(A>=0){var D=C.substring(A+2);E=String.fromCharCode(parseInt(D,16))}else{if(C.length===1&&B!==3){E=C}else{return l(f[C],B)}}if(F===true){E=E.toUpperCase()}else{if(F===false){E=E.toLowerCase()}}var G=E.charCodeAt(0);return q(G)}function m(A){return A<=31||(A>=127&&A<=159)}function q(A){if(m(A)){return 65280|A}if(A>=0&&A<=255){return A}if(A>=256&&A<=1114111){return 16777216|A}return null}function h(B,A){return l(u[B],A)}var e=function e(D,C){if(!C){return false}var A=C.indexOf("U+");if(A===-1){return true}var B=parseInt(C.substring(A+2),16);if(D!==B){return true}if((D>=65&&D<=90)||(D>=48&&D<=57)){return true}return false};this.press=function(B){if(B===null){return}if(!i.pressed[B]){i.pressed[B]=true;if(i.onkeydown){var A=i.onkeydown(B);n[B]=A;window.clearTimeout(d);window.clearInterval(o);if(!r[B]){d=window.setTimeout(function(){o=window.setInterval(function(){i.onkeyup(B);i.onkeydown(B)},50)},500)}return A}}return n[B]||false};this.release=function(A){if(i.pressed[A]){delete i.pressed[A];window.clearTimeout(d);window.clearInterval(o);if(A!==null&&i.onkeyup){i.onkeyup(A)}}};this.reset=function(){for(var A in i.pressed){i.release(parseInt(A))}z=[]};var a=function a(B){var A=VvWork.Keyboard.ModifierState.fromKeyboardEvent(B);if(i.modifiers.alt&&A.alt===false){i.release(65513);i.release(65514);i.release(65027)}if(i.modifiers.shift&&A.shift===false){i.release(65505);i.release(65506)}if(i.modifiers.ctrl&&A.ctrl===false){i.release(65507);i.release(65508)}if(i.modifiers.meta&&A.meta===false){i.release(65511);i.release(65512)}if(i.modifiers.hyper&&A.hyper===false){i.release(65515);i.release(65516)}i.modifiers=A};function g(){var B=p();if(!B){return false}var A;do{A=B;B=p()}while(B!==null);return A.defaultPrevented}var t=function t(A){if(!i.modifiers.ctrl||!i.modifiers.alt){return}if(A>=65&&A<=90){return}if(A>=97&&A<=122){return}if(A<=255||(A&4278190080)===16777216){i.release(65507);i.release(65508);i.release(65513);i.release(65514)}};var p=function p(){var D=z[0];if(!D){return null}if(D instanceof w){var C=null;var E=[];if(D.reliable){C=D.keysym;E=z.splice(0,1)}else{if(z[1] instanceof b){C=z[1].keysym;E=z.splice(0,2)}else{if(z[1]){C=D.keysym;E=z.splice(0,1)}}}if(E.length>0){if(C){t(C);var A=!i.press(C);k[D.keyCode]=C;if(i.modifiers.meta&&C!==65511&&C!==65512){i.release(C)}for(var B=0;B<E.length;B++){E[B].defaultPrevented=A}}return D}}else{if(D instanceof j){var C=D.keysym;if(C){i.release(C);D.defaultPrevented=true}else{i.reset();return D}return z.shift()}else{return z.shift()}}return null};var x=function x(A){if("location" in A){return A.location}if("keyLocation" in A){return A.keyLocation}return 0};c.addEventListener("keydown",function(C){if(!i.onkeydown){return}var B;if(window.event){B=window.event.keyCode}else{if(C.which){B=C.which}}a(C);if(B===229){return}var A=new w(B,C.keyIdentifier,C.key,x(C));z.push(A);if(g()){C.preventDefault()}},true);c.addEventListener("keypress",function(C){if(!i.onkeydown&&!i.onkeyup){return}var B;if(window.event){B=window.event.keyCode}else{if(C.which){B=C.which}}a(C);var A=new b(B);z.push(A);if(g()){C.preventDefault()}},true);c.addEventListener("keyup",function(C){if(!i.onkeyup){return}C.preventDefault();var B;if(window.event){B=window.event.keyCode}else{if(C.which){B=C.which}}a(C);var A=new j(B,C.keyIdentifier,C.key,x(C));z.push(A);g()},true)};VvWork.Keyboard.ModifierState=function(){this.shift=false;this.ctrl=false;this.alt=false;this.meta=false;this.hyper=false};VvWork.Keyboard.ModifierState.fromKeyboardEvent=function(b){var a=new VvWork.Keyboard.ModifierState();a.shift=b.shiftKey;a.ctrl=b.ctrlKey;a.alt=b.altKey;a.meta=b.metaKey;if(b.getModifierState){a.hyper=b.getModifierState("OS")||b.getModifierState("Super")||b.getModifierState("Hyper")||b.getModifierState("Win")}return a};var VvWork=VvWork||{};VvWork.Layer=function(a,o){var f=new VvWork.Logger();var i=this;var m=64;var d=document.createElement("canvas");var b=d.getContext("2d");b.save();var h=true;var e=true;var n=0;var k={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"};function c(u,s){u=u||0;s=s||0;var q=Math.ceil(u/m)*m;var t=Math.ceil(s/m)*m;if(d.width!==q||d.height!==t){var v=null;if(!h&&d.width!==0&&d.height!==0){v=document.createElement("canvas");v.width=Math.min(i.width,u);v.height=Math.min(i.height,s);var r=v.getContext("2d");r.drawImage(d,0,0,v.width,v.height,0,0,v.width,v.height)}var p=b.globalCompositeOperation;d.width=q;d.height=t;if(v){b.drawImage(v,0,0,v.width,v.height,0,0,v.width,v.height)}b.globalCompositeOperation=p;n=0;b.save()}else{i.reset()}i.width=u;i.height=s}function g(p,z,q,r){var u=q+p;var t=r+z;var s;if(u>i.width){s=u}else{s=i.width}var v;if(t>i.height){v=t}else{v=i.height}i.resize(s,v)}this.autosize=false;this.width=a;this.height=o;this.getCanvas=function l(){return d};this.toCanvas=function j(){var p=document.createElement("canvas");p.width=i.width;p.height=i.height;var q=p.getContext("2d");q.drawImage(i.getCanvas(),0,0);return p};this.resize=function(q,p){if(q!==i.width||p!==i.height){c(q,p)}};this.drawImage=function(p,r,q){if(i.autosize){g(p,r,q.width,q.height)}b.drawImage(q,p,r);h=false};this.transfer=function(B,s,q,t,E,C,A,v){var u=B.getCanvas();if(s>=u.width||q>=u.height){return}if(s+t>u.width){t=u.width-s}if(q+E>u.height){E=u.height-q}if(t===0||E===0){return}if(i.autosize){g(C,A,t,E)}var p=B.getCanvas().getContext("2d").getImageData(s,q,t,E);var z=b.getImageData(C,A,t,E);for(var w=0;w<t*E*4;w+=4){var r=new VvWork.Layer.Pixel(p.data[w],p.data[w+1],p.data[w+2],p.data[w+3]);var D=new VvWork.Layer.Pixel(z.data[w],z.data[w+1],z.data[w+2],z.data[w+3]);v(r,D);z.data[w]=D.red;z.data[w+1]=D.green;z.data[w+2]=D.blue;z.data[w+3]=D.alpha}b.putImageData(z,C,A);h=false};this.put=function(v,r,q,s,z,w,u){var t=v.getCanvas();if(r>=t.width||q>=t.height){return}if(r+s>t.width){s=t.width-r}if(q+z>t.height){z=t.height-q}if(s===0||z===0){return}if(i.autosize){g(w,u,s,z)}var p=v.getCanvas().getContext("2d").getImageData(r,q,s,z);b.putImageData(p,w,u);h=false};this.copy=function(t,r,q,s,v,p,w){var u=t.getCanvas();if(r>=u.width||q>=u.height){return}if(r+s>u.width){s=u.width-r}if(q+v>u.height){v=u.height-q}if(s===0||v===0){return}if(i.autosize){g(p,w,s,v)}b.drawImage(u,r,q,s,v,p,w,s,v);h=false};this.moveTo=function(p,q){if(e){b.beginPath();e=false}if(i.autosize){g(p,q,0,0)}b.moveTo(p,q)};this.lineTo=function(p,q){if(e){b.beginPath();e=false}if(i.autosize){g(p,q,0,0)}b.lineTo(p,q)};this.arc=function(q,u,p,t,r,s){if(e){b.beginPath();e=false}if(i.autosize){g(q,u,0,0)}b.arc(q,u,p,t,r,s)};this.curveTo=function(r,q,t,s,p,u){if(e){b.beginPath();e=false}if(i.autosize){g(p,u,0,0)}b.bezierCurveTo(r,q,t,s,p,u)};this.close=function(){b.closePath();e=true};this.rect=function(p,s,q,r){if(e){b.beginPath();e=false}if(i.autosize){g(p,s,q,r)}b.rect(p,s,q,r)};this.clip=function(){b.clip();e=true};this.strokeColor=function(t,w,s,v,u,p,q){b.lineCap=t;b.lineJoin=w;b.lineWidth=s;b.strokeStyle="rgba("+v+","+u+","+p+","+q/255+")";b.stroke();h=false;e=true};this.fillColor=function(t,s,p,q){b.fillStyle="rgba("+t+","+s+","+p+","+q/255+")";b.fill();h=false;e=true};this.strokeLayer=function(r,s,q,p){b.lineCap=r;b.lineJoin=s;b.lineWidth=q;b.strokeStyle=b.createPattern(p.getCanvas(),"repeat");b.stroke();h=false;e=true};this.fillLayer=function(p){b.fillStyle=b.createPattern(p.getCanvas(),"repeat");b.fill();h=false;e=true};this.push=function(){b.save();n++};this.pop=function(){if(n>0){b.restore();n--}};this.reset=function(){while(n>0){b.restore();n--}b.restore();b.save();b.beginPath();e=false};this.setTransform=function(q,p,u,t,s,r){b.setTransform(q,p,u,t,s,r)};this.transform=function(q,p,u,t,s,r){b.transform(q,p,u,t,s,r)};this.setChannelMask=function(p){b.globalCompositeOperation=k[p]};this.setMiterLimit=function(p){b.miterLimit=p};c(a,o);d.style.zIndex=-1};VvWork.Layer.ROUT=2;VvWork.Layer.ATOP=6;VvWork.Layer.XOR=10;VvWork.Layer.ROVER=11;VvWork.Layer.OVER=14;VvWork.Layer.PLUS=15;VvWork.Layer.RIN=1;VvWork.Layer.IN=4;VvWork.Layer.OUT=8;VvWork.Layer.RATOP=9;VvWork.Layer.SRC=12;VvWork.Layer.Pixel=function(f,e,c,d){this.red=f;this.green=e;this.blue=c;this.alpha=d};var VvWork=VvWork||{};VvWork.Logger_Level={debug:false,log:false,info:false,warn:false,error:false};VvWork.Logger=function(){var c=this;var e=function e(n){var p="";if(n.length>0){var o=n[0];var h=[];for(var l=1;l<n.length;l++){h.push(n[l])}if(o.indexOf("{}")>0){var m=o.split("{}");for(var l=0;l<m.length;l++){p+=m[l];if(l<h.length){p+=h[l]}if(l==m.length-1&&l<h.length){for(var k=l;k<h.length;k++){p+=h[k]}}}}else{for(var l=0;l<n.length;l++){p+=n[l];if(l<n.length-1){p+=separator}}}}return p};this.d=function a(h){if(VvWork.Logger_Level.debug||VvWork.Logger_Level.log||VvWork.Logger_Level.info||VvWork.Logger_Level.warn||VvWork.Logger_Level.error){var i="";if(arguments.length>0){i=e(arguments)}console.debug("["+new Date().getTime()+"]:"+i)}};this.l=function d(h){if(VvWork.Logger_Level.log||VvWork.Logger_Level.info||VvWork.Logger_Level.warn||VvWork.Logger_Level.error){var i="";if(arguments.length>0){i=e(arguments)}console.log("["+new Date().getTime()+"]:"+i)}};this.i=function f(h){if(VvWork.Logger_Level.info||VvWork.Logger_Level.warn||VvWork.Logger_Level.error){var i="";if(arguments.length>0){i=e(arguments)}console.info("["+new Date().getTime()+"]:"+i)}};this.w=function g(h){if(VvWork.Logger_Level.warn||VvWork.Logger_Level.error){var i="";if(arguments.length>0){i=e(arguments)}console.warn("["+new Date().getTime()+"]:"+i)}};this.e=function b(h){if(VvWork.Logger_Level.error){var i="";if(arguments.length>0){i=e(arguments)}console.error("["+new Date().getTime()+"]:"+i)}};return c};var VvWork=VvWork||{};VvWork.Mouse=function(c){var d=new VvWork.Logger();var i=this;this.touchMouseThreshold=3;this.scrollThreshold=53;this.PIXELS_PER_LINE=18;this.PIXELS_PER_PAGE=this.PIXELS_PER_LINE*16;this.currentState=new VvWork.Mouse.State(0,0,false,false,false,false,false);this.getPosition=function(){return{x:i.currentState.x,y:i.currentState.y}};this.onmousedown=null;this.onmouseup=null;this.onmousemove=null;this.onmouseout=null;var b=0;var h=0;function g(j){j.stopPropagation();if(j.preventDefault){j.preventDefault()}j.returnValue=false}c.addEventListener("contextmenu",function(j){g(j)},false);c.addEventListener("mousemove",function(j){g(j);if(b){b--;return}i.currentState.fromClientPosition(c,j.clientX,j.clientY);if(i.onmousemove){i.onmousemove(i.currentState)}},false);c.addEventListener("mousedown",function(j){g(j);if(b){return}switch(j.button){case 0:i.currentState.left=true;break;case 1:i.currentState.middle=true;break;case 2:i.currentState.right=true;break}if(i.onmousedown){i.onmousedown(i.currentState)}},false);c.addEventListener("mouseup",function(m){g(m);if(b){return}switch(m.button){case 0:i.currentState.left=false;break;case 1:i.currentState.middle=false;break;case 2:i.currentState.right=false;break}if(i.onmouseup){i.onmouseup(i.currentState)}var j=document.getElementById("text-input");if(!!!!j){var k=m.clientY;var l=m.clientX;if(window.innerHeight-k>40){j.style.top=(k+20)+"px"}else{j.style.top=(k-40)+"px"}if(window.innerWidth-l>40){j.style.left=(l+20)+"px"}else{j.style.left=(l-40)+"px"}}},false);c.addEventListener("mouseout",function(k){if(!k){k=window.event}var j=k.relatedTarget||k.toElement;while(j){if(j===c){return}j=j.parentNode}g(k);if(i.currentState.left||i.currentState.middle||i.currentState.right){i.currentState.left=false;i.currentState.middle=false;i.currentState.right=false;if(i.onmouseup){i.onmouseup(i.currentState)}}if(i.onmouseout){i.onmouseout()}},false);c.addEventListener("selectstart",function(j){g(j)},false);function f(){b=i.touchMouseThreshold}c.addEventListener("touchmove",f,false);c.addEventListener("touchstart",f,false);c.addEventListener("touchend",f,false);function a(j){var k=j.deltaY||-j.wheelDeltaY||-j.wheelDelta;if(k){if(j.deltaMode===1){k=j.deltaY*i.PIXELS_PER_LINE}else{if(j.deltaMode===2){k=j.deltaY*i.PIXELS_PER_PAGE}}}else{k=j.detail*i.PIXELS_PER_LINE}h+=k;if(h<=-i.scrollThreshold){do{if(i.onmousedown){i.currentState.up=true;i.onmousedown(i.currentState)}if(i.onmouseup){i.currentState.up=false;i.onmouseup(i.currentState)}h+=i.scrollThreshold}while(h<=-i.scrollThreshold);h=0}if(h>=i.scrollThreshold){do{if(i.onmousedown){i.currentState.down=true;i.onmousedown(i.currentState)}if(i.onmouseup){i.currentState.down=false;i.onmouseup(i.currentState)}h-=i.scrollThreshold}while(h>=i.scrollThreshold);h=0}g(j)}c.addEventListener("DOMMouseScroll",a,false);c.addEventListener("mousewheel",a,false);c.addEventListener("wheel",a,false);var e=(function(){var k=document.createElement("div");if(!("cursor" in k.style)){return false}try{k.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(j){return false}return/\burl\([^()]*\)\s+0\s+0\b/.test(k.style.cursor||"")})();this.setCursor=function(k,j,m){if(e){var l=k.toDataURL("image/png");c.style.cursor="url("+l+") "+j+" "+m+", auto";return true}return false}};VvWork.Mouse.State=function(f,e,a,i,h,d,g){var c=new VvWork.Logger();var b=this;this.x=f;this.y=e;this.left=a;this.middle=i;this.right=h;this.up=d;this.down=g;this.fromClientPosition=function(k,o,n){b.x=o-k.offsetLeft;b.y=n-k.offsetTop;var m=k.offsetParent;while(m&&!(m===document.body)){b.x-=m.offsetLeft-m.scrollLeft;b.y-=m.offsetTop-m.scrollTop;m=m.offsetParent}if(m){var l=document.body.scrollLeft||document.documentElement.scrollLeft;var j=document.body.scrollTop||document.documentElement.scrollTop;b.x-=m.offsetLeft-l;b.y-=m.offsetTop-j}};this.toClientPosition=function(k){var o=0;var n=0;var m=k.offsetParent;while(m&&!(m===document.body)){b.x+=m.offsetLeft+m.scrollLeft;b.y+=m.offsetTop+m.scrollTop;m=m.offsetParent}if(m){var l=document.body.scrollLeft||document.documentElement.scrollLeft;var j=document.body.scrollTop||document.documentElement.scrollTop;b.x+=m.offsetLeft+l;b.y+=m.offsetTop+j}o=b.x+k.offsetLeft;o=b.y+k.offsetTop;return{x:o,y:n}}};VvWork.Mouse.Touchpad=function(d){var e=new VvWork.Logger();var a=this;this.scrollThreshold=20*(window.devicePixelRatio||1);this.clickTimingThreshold=250;this.clickMoveThreshold=10*(window.devicePixelRatio||1);this.currentState=new VvWork.Mouse.State(0,0,false,false,false,false,false);this.onmousedown=null;this.onmouseup=null;this.onmousemove=null;var b=0;var i=0;var h=0;var g=0;var f=0;var c={1:"left",2:"right",3:"middle"};var k=false;var j=null;d.addEventListener("touchend",function(n){n.preventDefault();if(k&&n.touches.length===0){var m=new Date().getTime();var l=c[b];if(a.currentState[l]){a.currentState[l]=false;if(a.onmouseup){a.onmouseup(a.currentState)}if(j){window.clearTimeout(j);j=null}}if(m-g<=a.clickTimingThreshold&&f<a.clickMoveThreshold){a.currentState[l]=true;if(a.onmousedown){a.onmousedown(a.currentState)}j=window.setTimeout(function(){a.currentState[l]=false;if(a.onmouseup){a.onmouseup(a.currentState)}k=false},a.clickTimingThreshold)}if(!j){k=false}}},false);d.addEventListener("touchstart",function(m){m.preventDefault();b=Math.min(m.touches.length,3);if(j){window.clearTimeout(j);j=null}if(!k){k=true;var l=m.touches[0];i=l.clientX;h=l.clientY;g=new Date().getTime();f=0}},false);d.addEventListener("touchmove",function(n){n.preventDefault();var r=n.touches[0];var q=r.clientX-i;var p=r.clientY-h;f+=Math.abs(q)+Math.abs(p);if(b===1){var m=f/(new Date().getTime()-g);var o=1+m;a.currentState.x+=q*o;a.currentState.y+=p*o;if(a.currentState.x<0){a.currentState.x=0}else{if(a.currentState.x>=d.offsetWidth){a.currentState.x=d.offsetWidth-1}}if(a.currentState.y<0){a.currentState.y=0}else{if(a.currentState.y>=d.offsetHeight){a.currentState.y=d.offsetHeight-1}}if(a.onmousemove){a.onmousemove(a.currentState)}i=r.clientX;h=r.clientY}else{if(b===2){if(Math.abs(p)>=a.scrollThreshold){var l;if(p>0){l="down"}else{l="up"}a.currentState[l]=true;if(a.onmousedown){a.onmousedown(a.currentState)}a.currentState[l]=false;if(a.onmouseup){a.onmouseup(a.currentState)}i=r.clientX;h=r.clientY}}}},false)};VvWork.Mouse.Touchscreen=function(d){var e=new VvWork.Logger();var f=this;var l=false;var k=null;var j=null;var m=null;var i=null;this.scrollThreshold=20*(window.devicePixelRatio||1);this.clickTimingThreshold=250;this.clickMoveThreshold=16*(window.devicePixelRatio||1);this.longPressThreshold=500;this.currentState=new VvWork.Mouse.State(0,0,false,false,false,false,false);this.onmousedown=null;this.onmouseup=null;this.onmousemove=null;function n(p){if(!f.currentState[p]){f.currentState[p]=true;if(f.onmousedown){f.onmousedown(f.currentState)}}}function h(p){if(f.currentState[p]){f.currentState[p]=false;if(f.onmouseup){f.onmouseup(f.currentState)}}}function c(p){n(p);h(p)}function b(p,q){f.currentState.fromClientPosition(d,p,q);if(f.onmousemove){f.onmousemove(f.currentState)}}function a(p){var s=p.touches[0]||p.changedTouches[0];var r=s.clientX-k;var q=s.clientY-j;return Math.sqrt(r*r+q*q)>=f.clickMoveThreshold}function g(p){var q=p.touches[0];l=true;k=q.clientX;j=q.clientY}function o(){window.clearTimeout(m);window.clearTimeout(i);l=false}d.addEventListener("touchend",function(p){if(!l){return}if(p.touches.length!==0||p.changedTouches.length!==1){o();return}window.clearTimeout(i);h("left");if(!a(p)){p.preventDefault();if(!f.currentState.left){var q=p.changedTouches[0];b(q.clientX,q.clientY);n("left");m=window.setTimeout(function(){h("left");o()},f.clickTimingThreshold)}}},false);d.addEventListener("touchstart",function(p){if(p.touches.length!==1){o();return}p.preventDefault();g(p);window.clearTimeout(m);i=window.setTimeout(function(){var q=p.touches[0];b(q.clientX,q.clientY);c("right");o()},f.longPressThreshold)},false);d.addEventListener("touchmove",function(p){if(!l){return}if(a(p)){window.clearTimeout(i)}if(p.touches.length!==1){o();return}if(f.currentState.left){p.preventDefault();var q=p.touches[0];b(q.clientX,q.clientY)}},false)};var VvWork=VvWork||{};var VvWork=VvWork||{};VvWork.Object=function vvWorkObject(e,f){var g=this;var h={};var a=function a(j){var k=h[j];if(!k){return null}var l=k.shift();if(k.length===0){delete h[j]}return l};var d=function d(j,l){var k=h[j];if(!k){k=[];h[j]=k}k.push(l)};this.index=f;this.onbody=function i(l,j,k){var m=a(k);if(m){m(l,j)}};this.onundefine=null;this.requestInputStream=function c(k,j){if(j){d(k,j)}e.requestObjectInputStream(g.index,k)};this.createOutputStream=function b(j,k){return e.createObjectOutputStream(g.index,j,k)}};VvWork.Object.ROOT_STREAM="/";VvWork.Object.STREAM_INDEX_MIMETYPE="application/vnd.vvwork.stream-index+json";var VvWork=VvWork||{};VvWork.OnScreenKeyboard=function(q){var e=this;var h={};var b={};var d=[];var i=function i(u,v){if(u.classList){u.classList.add(v)}else{u.className+=" "+v}};var j=function j(u,w){if(u.classList){u.classList.remove(w)}else{u.className=u.className.replace(/([^ ]+)[ ]*/g,function v(y,x){if(x===w){return""}return y})}};var t=0;var f=function f(){t=e.touchMouseThreshold};var r=function r(v,w,u,x){this.width=w;this.height=u;this.scale=function(y){v.style.width=(w*y)+"px";v.style.height=(u*y)+"px";if(x){v.style.lineHeight=(u*y)+"px";v.style.fontSize=y+"px"}}};var l=function l(w){for(var v=0;v<w.length;v++){var u=w[v];if(!(u in h)){return false}}return true};var g=function g(w){var x=e.keys[w];if(!x){return null}for(var u=x.length-1;u>=0;u--){var v=x[u];if(l(v.requires)){return v}}return null};var m=function m(x,y){if(!b[x]){i(y,"guac-keyboard-pressed");var w=g(x);if(w.modifier){var v="guac-keyboard-modifier-"+n(w.modifier);var u=h[w.modifier];if(!u){i(c,v);h[w.modifier]=w.keysym;if(e.onkeydown){e.onkeydown(w.keysym)}}else{j(c,v);delete h[w.modifier];if(e.onkeyup){e.onkeyup(u)}}}else{if(e.onkeydown){e.onkeydown(w.keysym)}}b[x]=true}};var o=function o(v,w){if(b[v]){j(w,"guac-keyboard-pressed");var u=g(v);if(!u.modifier&&e.onkeyup){e.onkeyup(u.keysym)}b[v]=false}};var c=document.createElement("div");c.className="guac-keyboard";c.onselectstart=c.onmousemove=c.onmouseup=c.onmousedown=function k(u){if(t){t--}u.stopPropagation();return false};this.touchMouseThreshold=3;this.onkeydown=null;this.onkeyup=null;this.layout=new VvWork.OnScreenKeyboard.Layout(q);this.getElement=function(){return c};this.resize=function(w){var x=Math.floor(w*10/e.layout.width)/10;for(var v=0;v<d.length;v++){var u=d[v];u.scale(x)}};var s=function s(v,u){if(u instanceof Array){var x=[];for(var w=0;w<u.length;w++){x.push(new VvWork.OnScreenKeyboard.Key(u[w],v))}return x}if(typeof u==="number"){return[new VvWork.OnScreenKeyboard.Key({name:v,keysym:u})]}if(typeof u==="string"){return[new VvWork.OnScreenKeyboard.Key({name:v,title:u})]}return[new VvWork.OnScreenKeyboard.Key(u,v)]};var a=function a(w){var v={};for(var u in q.keys){v[u]=s(u,w[u])}return v};this.keys=a(q.keys);var n=function n(u){var v=u.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase();return v};var p=function p(A,x,v){var B;var u=document.createElement("div");if(v){i(u,"guac-keyboard-"+n(v))}if(x instanceof Array){i(u,"guac-keyboard-group");for(B=0;B<x.length;B++){p(u,x[B])}}else{if(x instanceof Object){i(u,"guac-keyboard-group");var F=Object.keys(x).sort();for(B=0;B<F.length;B++){var v=F[B];p(u,x[v],v)}}else{if(typeof x==="number"){i(u,"guac-keyboard-gap");d.push(new r(u,x,x))}else{if(typeof x==="string"){var H=x;if(H.length===1){H="0x"+H.charCodeAt(0).toString(16)}i(u,"guac-keyboard-key-container");var J=document.createElement("div");J.className="guac-keyboard-key guac-keyboard-key-"+n(H);var I=e.keys[x];if(I){for(B=0;B<I.length;B++){var G=I[B];var E=document.createElement("div");E.className="guac-keyboard-cap";E.textContent=G.title;for(var y=0;y<G.requires.length;y++){var K=G.requires[y];i(E,"guac-keyboard-requires-"+n(K));i(J,"guac-keyboard-uses-"+n(K))}J.appendChild(E)}}u.appendChild(J);d.push(new r(u,e.layout.keyWidths[x]||1,1,true));var D=function D(L){L.preventDefault();t=e.touchMouseThreshold;m(x,J)};var w=function w(L){L.preventDefault();t=e.touchMouseThreshold;o(x,J)};var z=function z(L){L.preventDefault();if(t===0){m(x,J)}};var C=function C(L){L.preventDefault();if(t===0){o(x,J)}};J.addEventListener("touchstart",D,true);J.addEventListener("touchend",w,true);J.addEventListener("mousedown",z,true);J.addEventListener("mouseup",C,true);J.addEventListener("mouseout",C,true)}}}}A.appendChild(u)};p(c,q.layout)};VvWork.OnScreenKeyboard.Layout=function(a){this.language=a.language;this.type=a.type;this.keys=a.keys;this.layout=a.layout;this.width=a.width;this.keyWidths=a.keyWidths||{}};VvWork.OnScreenKeyboard.Key=function(c,a){this.name=a||c.name;this.title=c.title||this.name;this.keysym=c.keysym||(function b(e){if(!e||e.length!==1){return null}var d=e.charCodeAt(0);if(d>=0&&d<=255){return d}if(d>=256&&d<=1114111){return 16777216|d}return null})(this.title);this.modifier=c.modifier;this.requires=c.requires||[]};var VvWork=VvWork||{};VvWork.OutputStream=function(a,b){var c=this;this.index=b;this.onack=null;this.sendBlob=function(d){a.sendBlob(c.index,d)};this.sendEnd=function(){a.endStream(c.index)}};var VvWork=VvWork||{};VvWork.Parser=function(){var e=this;var b="";var d=[];var c=-1;var a=0;this.receive=function(k){if(a>4096&&c>=a){b=b.substring(a);c-=a;a=0}b+=k;while(c<b.length){if(c>=a){var h=b.substring(a,c);var g=b.substring(c,c+1);d.push(h);if(g==";"){var j=d.shift();if(e.oninstruction!=null){e.oninstruction(j,d)}d.length=0}else{if(g!=","){throw new Error("Illegal terminator.")}}a=c+1}var f=b.indexOf(".",a);if(f!=-1){var i=parseInt(b.substring(c+1,f));if(isNaN(i)){throw new Error("Non-numeric character in element length.")}a=f+1;c=a+i}else{a=b.length;break}}};this.oninstruction=null};var VvWork=VvWork||{};VvWork.RawAudioFormat=function RawAudioFormat(a){this.bytesPerSample=a.bytesPerSample;this.channels=a.channels;this.rate=a.rate};VvWork.RawAudioFormat.parse=function parseFormat(g){var b;var f=null;var e=1;if(g.substring(0,9)==="audio/L8;"){g=g.substring(9);b=1}else{if(g.substring(0,10)==="audio/L16;"){g=g.substring(10);b=2}else{return null}}var k=g.split(",");for(var d=0;d<k.length;d++){var j=k[d];var c=j.indexOf("=");if(c===-1){return null}var a=j.substring(0,c);var h=j.substring(c+1);switch(a){case"channels":e=parseInt(h);break;case"rate":f=parseInt(h);break;default:return null}}if(f===null){return null}return new VvWork.RawAudioFormat({bytesPerSample:b,channels:e,rate:f})};var VvWork=VvWork||{};VvWork.SessionRecording=function SessionRecording(v){var b=this;var m=16384;var x=5000;var i=5;var q=[];var a=[];var r=0;var j=0;var s=new VvWork.SessionRecording._PlaybackTunnel();var f=new VvWork.Client(s);var l=-1;var g=null;var d=null;var y=null;f.connect();f.getDisplay().showCursor(false);v.oninstruction=function B(I,G){var F=new VvWork.SessionRecording._Frame.Instruction(I,G.slice());a.push(F);r+=F.getSize();if(I==="sync"){var H=parseInt(G[0]);var J=new VvWork.SessionRecording._Frame(H,a);q.push(J);if(q.length===1||(r>=m&&H-j>=x)){J.keyframe=true;j=H;r=0}a=[];if(b.onprogress){b.onprogress(b.getDuration())}}};var u=function u(F){if(q.length===0){return 0}return F-q[0].timestamp};var o=function o(G,H,J){if(G===H){return G}var F=Math.floor((G+H)/2);var I=u(q[F].timestamp);if(J<I&&F>G){return o(G,F-1,J)}if(J>I&&F<H){return o(F+1,H,J)}return F};var A=function A(G){var I=q[G];for(var H=0;H<I.instructions.length;H++){var F=I.instructions[H];s.receiveInstruction(F.opcode,F.args)}if(I.keyframe&&!I.clientState){f.exportState(function J(K){I.clientState=K})}};var n=function n(H,I,G){w();y=window.setTimeout(function F(){var M;for(M=H;M>=0;M--){var L=q[M];if(M===l){break}if(L.clientState){f.importState(L.clientState);break}}M++;var J=new Date().getTime();for(;M<=H;M++){var K=new Date().getTime();if(K-J>=i){break}A(M)}l=M-1;if(b.onseek){b.onseek(b.getPosition())}if(l!==H){n(H,I,Math.max(G-(new Date().getTime()-J),0))}else{I()}},G||0)};var w=function w(){window.clearTimeout(y)};var t=function t(){if(l+1<q.length){var G=q[l+1];var I=G.timestamp-g+d;var F=Math.max(I-new Date().getTime(),0);n(l+1,function H(){t()},F)}else{b.pause()}};this.onprogress=null;this.onplay=null;this.onpause=null;this.onseek=null;this.connect=function c(F){v.connect(F)};this.disconnect=function C(){v.disconnect()};this.getDisplay=function p(){return f.getDisplay()};this.isPlaying=function h(){return !!g};this.getPosition=function D(){if(l===-1){return 0}return u(q[l].timestamp)};this.getDuration=function E(){if(q.length===0){return 0}return u(q[q.length-1].timestamp)};this.play=function z(){if(!b.isPlaying()&&l+1<q.length){if(b.onplay){b.onplay()}var F=q[l+1];g=F.timestamp;d=new Date().getTime();t()}};this.seek=function e(F,I){if(q.length===0){return}var H=b.isPlaying();b.pause();n(o(0,q.length-1,F),function G(){if(H){b.play()}if(I){I()}})};this.pause=function k(){w();if(b.isPlaying()){if(b.onpause){b.onpause()}g=null;d=null}}};VvWork.SessionRecording._Frame=function _Frame(b,a){this.keyframe=false;this.timestamp=b;this.instructions=a;this.clientState=null};VvWork.SessionRecording._Frame.Instruction=function Instruction(d,b){var a=this;this.opcode=d;this.args=b;this.getSize=function c(){var f=a.opcode.length;for(var e=0;e<a.args.length;e++){f+=a.args[e].length}return f}};VvWork.SessionRecording._PlaybackTunnel=function _PlaybackTunnel(){var e=this;this.connect=function b(f){};this.sendMessage=function c(f){};this.disconnect=function a(){};this.receiveInstruction=function d(g,f){if(e.oninstruction){e.oninstruction(g,f)}}};var VvWork=VvWork||{};VvWork.Status=function(b,a){var c=this;this.code=b;this.message=a;this.isError=function(){return c.code<0||c.code>255}};VvWork.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,RESOURCE_CLOSED:518,UPSTREAM_NOT_FOUND:519,UPSTREAM_UNAVAILABLE:520,SESSION_CONFLICT:521,SESSION_TIMEOUT:522,SESSION_CLOSED:523,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797};var VvWork=VvWork||{};VvWork.StringReader=function(e){var d=this;var b=new VvWork.ArrayBufferReader(e);var f=0;var c=0;function a(h){var l="";var g=new Uint8Array(h);for(var j=0;j<g.length;j++){var k=g[j];if(f===0){if((k|127)===127){l+=String.fromCharCode(k)}else{if((k|31)===223){c=k&31;f=1}else{if((k|15)===239){c=k&15;f=2}else{if((k|7)===247){c=k&7;f=3}else{l+="\uFFFD"}}}}}else{if((k|63)===191){c=(c<<6)|(k&63);f--;if(f===0){l+=String.fromCharCode(c)}}else{f=0;l+="\uFFFD"}}}return l}b.ondata=function(g){var h=a(g);if(d.ontext){d.ontext(h)}};b.onend=function(){if(d.onend){d.onend()}};this.ontext=null;this.onend=null};var VvWork=VvWork||{};VvWork.StringWriter=function(h){var e=this;var c=new VvWork.ArrayBufferWriter(h);var a=new Uint8Array(8192);var g=0;c.onack=function(i){if(e.onack){e.onack(i)}};function f(i){if(g+i>=a.length){var j=new Uint8Array((g+i)*2);j.set(a);a=j}g+=i}function d(m){var k;var j;if(m<=127){k=0;j=1}else{if(m<=2047){k=192;j=2}else{if(m<=65535){k=224;j=3}else{if(m<=2097151){k=240;j=4}else{d(65533);return}}}}f(j);var n=g-1;for(var l=1;l<j;l++){a[n--]=128|(m&63);m>>=6}a[n]=k|m}function b(m){for(var j=0;j<m.length;j++){var l=m.charCodeAt(j);d(l)}if(g>0){var k=a.subarray(0,g);g=0;return k}}this.sendText=function(i){if(i.length){c.sendData(b(i))}};this.sendEnd=function(){c.sendEnd()};this.onack=null};var VvWork=VvWork||{};VvWork.Tunnel=function(){this.connect=function(a){};this.disconnect=function(){};this.sendMessage=function(a){};this.setState=function(a){if(a!==this.state){this.state=a;if(this.onstatechange){this.onstatechange(a)}}};this.state=VvWork.Tunnel.State.CONNECTING;this.receiveTimeout=15000;this.uuid=null;this.onerror=null;this.onstatechange=null;this.oninstruction=null};VvWork.Tunnel.INTERNAL_DATA_OPCODE="";VvWork.Tunnel.State={CONNECTING:0,CONNECTED:3,OPEN:1,CLOSED:2};VvWork.HTTPTunnel=function(h,n,x){var p=new VvWork.Logger();var u=this;var l;var j=h+"?connect";var y=h+"?read:";var m=h+"?write:";var i=1;var o=0;var v=i;var s=false;var g="";var c=!!n;var d=null;var e=x||{};function k(A,B){for(var z in B){A.setRequestHeader(z,B[z])}}function b(){window.clearTimeout(d);d=window.setTimeout(function(){p.i("receive_timeout close tunnel.code:"+VvWork.Status.Code.UPSTREAM_TIMEOUT);a(new VvWork.Status(VvWork.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},u.receiveTimeout)}function a(z){if(u.state===VvWork.Tunnel.State.CLOSED){return}if(z.code!==VvWork.Status.Code.SUCCESS&&u.onerror){if(u.state===VvWork.Tunnel.State.CONNECTING||z.code!==VvWork.Status.Code.RESOURCE_NOT_FOUND){u.onerror(z)}}s=false;u.setState(VvWork.Tunnel.State.CLOSED)}this.sendMessage=function(){if(u.state!==VvWork.Tunnel.State.OPEN&&u.state!==VvWork.Tunnel.State.CONNECTED){return}if(arguments.length===0){return}function B(E){var D=new String(E);return D.length+"."+D}var z=arguments[0]=="virwork";var C=B(arguments[0]);for(var A=1;A<arguments.length;A++){C+=","+B(arguments[A])}C+=";";g+=C;if(!s){r()}};function r(){if(u.state!==VvWork.Tunnel.State.OPEN&&u.state!==VvWork.Tunnel.State.CONNECTED){return}if(g.length>0){if(g.indexOf("14.system-destroy")==0){u.oninstruction("destroystate","true");u.disconnect();window.clearTimeout(d);return}s=true;var z=new XMLHttpRequest();z.open("POST",m+u.uuid);z.withCredentials=c;k(z,e);z.setRequestHeader("Content-type","application/octet-stream");z.onreadystatechange=function(){if(z.readyState===4){if(z.status!==200){q(z)}else{r()}}};p.e("http-tunnel send message:"+g);z.send(g);g=""}else{s=false}}function q(B){var A=parseInt(B.getResponseHeader("VvWork-Status-Code"));var z=B.getResponseHeader("VvWork-Error-Message");a(new VvWork.Status(A,z))}function w(C){var z=null;var E=null;var B=0;var A=-1;var F=0;var D=new Array();function G(){if(u.state!==VvWork.Tunnel.State.OPEN&&u.state!==VvWork.Tunnel.State.CONNECTED){if(z!==null){clearInterval(z)}return}if(C.readyState<2){return}var J;try{J=C.status}catch(M){J=200}if(!E&&J===200){E=t()}if(C.readyState===3||C.readyState===4){b();if(v===i){if(C.readyState===3&&!z){z=setInterval(G,30)}else{if(C.readyState===4&&!z){clearInterval(z)}}}if(C.status===0){u.disconnect();return}else{if(C.status!==200){q(C);return}}var N;try{N=C.responseText;p.e("recive(http tunnel):"+N)}catch(M){return}while(A<N.length){if(A>=F){var L=N.substring(F,A);var H=N.substring(A,A+1);D.push(L);if(H===";"){var K=D.shift();if(u.oninstruction){p.e("system destroy:"+K);if(K=="system-destroy"){u.oninstruction("destroystate","true");u.disconnect();window.clearTimeout(d)}else{u.oninstruction(K,D);var O={error:true,disconnect:true};if(!O[K]){u.state=VvWork.Tunnel.State.CONNECTED;if(u.onstatechange){u.onstatechange(u.state)}}}}D.length=0}F=A+1}var P=N.indexOf(".",F);if(P!==-1){var I=parseInt(N.substring(A+1,P));if(I===0){if(!z){clearInterval(z)}C.onreadystatechange=null;C.abort();if(E){w(E)}break}F=P+1;A=F+I}else{F=N.length;break}}}}if(v===i){C.onreadystatechange=function(){if(C.readyState===3){B++;if(B>=2){v=o;C.onreadystatechange=G}}G()}}else{C.onreadystatechange=G}G()}var f=0;function t(){var z=new XMLHttpRequest();z.open("GET",y+u.uuid+":"+(f++));z.withCredentials=c;k(z,e);z.send(null);return z}this.connect=function(z){b();u.setState(VvWork.Tunnel.State.CONNECTING);var A=new XMLHttpRequest();A.onreadystatechange=function(){if(A.readyState!==4){return}if(A.status!==200){q(A);return}b();var C=A.responseText;var I=C.split("=");u.uuid=A.responseText;l=I[0];u.oninstruction("token_id",l);if(I.length==2){var E=I[1].split(";");for(var H=0;H<E.length;H++){var G=E[H];if(G==""||G.length==0){continue}var B=E[H].split(",");var K=B[1].split(".");var D=K[1];if(G.indexOf("5.desktop")==0){u.oninstruction("desktop",D)}else{if(G.indexOf("3.sso")==0){u.oninstruction("sso",D)}else{if(G.indexOf("6.opened")==0){u.oninstruction("opened",D)}else{if(G.indexOf("13.display_scale")==0){var J=B[1];var F=J.substring(J.indexOf(".")+1,J.length);u.oninstruction("display_scale",F)}else{if(G.indexOf("13.display_width")==0){u.oninstruction("display_width",D)}else{if(G.indexOf("14.display_height")==0){u.oninstruction("display_height",D)}}}}}}}}u.state=VvWork.Tunnel.State.OPEN;if(u.onstatechange){u.onstatechange(u.state)}w(t())};A.open("POST",j,true);A.withCredentials=c;k(A,e);A.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");A.send(z);p.i("http tunnel connect. ")};this.disconnect=function(){p.i("http tunnel diconnect. Manually closed.");a(new VvWork.Status(VvWork.Status.Code.SUCCESS,"Manually closed."))}};VvWork.HTTPTunnel.prototype=new VvWork.Tunnel();VvWork.WebSocketTunnel=function(c){var e=new VvWork.Logger();var f=this;var g=null;var a=null;var b={"http:":"ws:","https:":"wss:"};if(c.substring(0,3)!=="ws:"&&c.substring(0,4)!=="wss:"){var i=b[window.location.protocol];if(c.substring(0,1)==="/"){c=i+"//"+window.location.host+c}else{var d=window.location.pathname.lastIndexOf("/");var k=window.location.pathname.substring(0,d+1);c=i+"//"+window.location.host+k+c}}function j(){window.clearTimeout(a);a=null;a=window.setTimeout(function(){e.i("reset_timeout(ws) close tunnel. code:"+VvWork.Status.Code.UPSTREAM_TIMEOUT);h(new VvWork.Status(VvWork.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},f.receiveTimeout)}function h(l){if(f.state===VvWork.Tunnel.State.CLOSED){e.i("ws already closed.");return}if(l.code!==VvWork.Status.Code.SUCCESS&&f.onerror){e.i("connection closed abnormally, signal error.");f.onerror(l)}f.setState(VvWork.Tunnel.State.CLOSED);e.i("ws close...");g.close()}this.sendMessage=function(o){if(f.state!==VvWork.Tunnel.State.CONNECTED){return}if(arguments.length===0){return}function m(q){var p=new String(q);return p.length+"."+p}var n=m(arguments[0]);if(n!="4.sync"){for(var l=1;l<arguments.length;l++){n+=","+m(arguments[l])}n+=";";e.e("ws-client send message:"+n);g.send(n)}else{e.e("ws-client send ping time message:"+n)}};this.connect=function(l){j();f.setState(VvWork.Tunnel.State.OPEN);g=new WebSocket(c+"?"+l,"vvwork");g.onopen=function(m){j();f.setState(VvWork.Tunnel.State.CONNECTING);e.i("WebSocket Open:"+f.state+"->"+c+"?"+l)};g.onclose=function(m){e.i("ws on close.");h(new VvWork.Status(parseInt(m.reason),m.reason));e.i("WebSocket Close:"+f.state);e.i("WebSocket Close:"+JSON.stringify(m))};g.onerror=function(m){e.i("WebSocket on error.");h(new VvWork.Status(VvWork.Status.Code.SERVER_ERROR,m.data));e.i("WebSocket Error:"+VvWork.Status.Code.SERVER_ERROR);e.i("WebSocket Error:"+JSON.stringify(m))};g.onmessage=function(o){j();var w=o.data;var u=0;var t;var n=[];do{var v=w.indexOf(".",u);if(v!==-1){var p=parseInt(w.substring(t+1,v));u=v+1;t=u+p}else{e.i("recive null text.");h(new VvWork.Status(VvWork.Status.Code.SERVER_ERROR,"Incomplete instruction."))}e.e("recive:"+w);var r=w.substring(u,t);var m=w.substring(t,t+1);n.push(r);if(m===";"){var q=n.shift();if(f.oninstruction){e.e("opcode:"+q+","+n+":"+n.length);if(q=="desktop"){f.oninstruction("desktop","true")}else{if(q=="sso"){f.oninstruction("sso","true")}else{if(q=="opened"){f.oninstruction("opened","true")}else{if(q=="display_scale"){f.oninstruction("display_scale",n[0])}else{if(q=="display_width"){f.oninstruction("display_width",n[0])}else{if(q=="display_height"){f.oninstruction("display_height",n[0])}else{if(q=="token_id"){f.oninstruction("token_id",n[0])}else{if(q=="system-destroy"){f.oninstruction("destroystate","true");f.disconnect()}else{f.oninstruction(q,n)}}}}}}}}var s={error:true,disconnect:true};if(!s[q]){f.state=VvWork.Tunnel.State.CONNECTED;if(f.onstatechange){f.onstatechange(f.state)}}}n.length=0}u=t+1}while(u<w.length)}};this.disconnect=function(){e.i("client ws disconnect.");h(new VvWork.Status(VvWork.Status.Code.SUCCESS,"Manually closed."))}};VvWork.WebSocketTunnel.prototype=new VvWork.Tunnel();VvWork.ChainedTunnel=function(f){var b=new VvWork.Logger();var d=this;var a;var h=[];var g=null;for(var e=0;e<arguments.length;e++){h.push(arguments[e])}function c(k){d.disconnect=k.disconnect;d.sendMessage=k.sendMessage;var j=function j(l){if(l&&l.code===VvWork.Status.Code.UPSTREAM_TIMEOUT){h=[];return null}var m=h.shift();if(m){k.onerror=null;k.oninstruction=null;k.onstatechange=null;c(m)}return m};function i(){k.onstatechange=d.onstatechange;k.oninstruction=d.oninstruction;k.onerror=d.onerror;d.uuid=k.uuid;g=k}k.onstatechange=function(l){switch(l){case VvWork.Tunnel.State.OPEN:i();if(d.onstatechange){d.onstatechange(l)}break;case VvWork.Tunnel.State.CLOSED:if(!j()&&d.onstatechange){d.onstatechange(l)}break}};k.oninstruction=function(m,l){b.i("recive opcode:"+m);i();if(d.oninstruction){d.oninstruction(m,l)}};k.onerror=function(l){if(!j(l)&&d.onerror){d.onerror(l)}};k.connect(a)}this.connect=function(j){a=j;var i=g?g:h.shift();if(i){c(i)}else{if(d.onerror){d.onerror(VvWork.Status.Code.SERVER_ERROR,"No tunnels to try.")}}}};VvWork.ChainedTunnel.prototype=new VvWork.Tunnel();VvWork.StaticHTTPTunnel=function StaticHTTPTunnel(a,d,j){var e=new VvWork.Logger();var g=this;var i=null;var b=j||{};function k(n,o){for(var m in o){n.setRequestHeader(m,o[m])}}var c=function c(m){switch(m){case 400:return VvWork.Status.Code.CLIENT_BAD_REQUEST;case 403:return VvWork.Status.Code.CLIENT_FORBIDDEN;case 404:return VvWork.Status.Code.RESOURCE_NOT_FOUND;case 429:return VvWork.Status.Code.CLIENT_TOO_MANY;case 503:return VvWork.Status.Code.SERVER_BUSY}return VvWork.Status.Code.SERVER_ERROR};this.sendMessage=function f(m){};this.connect=function l(n){g.disconnect();g.setState(VvWork.Tunnel.State.CONNECTING);i=new XMLHttpRequest();i.open("GET",a);i.withCredentials=!!d;k(i,b);i.responseType="text";i.send(null);var p=0;var r=new VvWork.Parser();r.oninstruction=function q(t,s){if(g.oninstruction){g.oninstruction(t,s)}};i.onreadystatechange=function o(){if(i.readyState===3||i.readyState===4){g.setState(VvWork.Tunnel.State.OPEN);var s=i.responseText;var t=s.length;if(p<t){r.receive(s.substring(p));p=t}}if(i.readyState===4){g.disconnect()}};i.onerror=function m(){if(g.onerror){g.onerror(new VvWork.Status(c(i.status),i.statusText))}g.disconnect()}};this.disconnect=function h(){if(i){i.abort();i=null}g.setState(VvWork.Tunnel.State.CLOSED)}};VvWork.StaticHTTPTunnel.prototype=new VvWork.Tunnel();var VvWork=VvWork||{};VvWork.API_VERSION="4.0.0.7";var VvWork=VvWork||{};VvWork.VideoPlayer=function VideoPlayer(){this.sync=function a(){}};VvWork.VideoPlayer.isSupportedType=function isSupportedType(a){return false};VvWork.VideoPlayer.getSupportedTypes=function getSupportedTypes(){return[]};VvWork.VideoPlayer.getInstance=function getInstance(c,b,a){return null};